<workflowGraph name="SsaBlat">
  <param name="parentDataDir"/>
  <param name="genomicSeqsDir"/>
  <param name="genomicSeqsFile"/>
  <param name="shortSeqsFile"/>
  <param name="outputUniqueFile"/>
  <param name="outputNonUniqueFile"/>
  <param name="isChipSeq"/>
  <param name="readLength"/>
  <param name="maxIntronSize"/>

  <constant name="dataDir">$$parentDataDir$$/ssaBlat</constant>
  <constant name="mdustOutputFile">$$dataDir$$/mdust.out</constant>
  <constant name="blatOutputFile">$$dataDir$$/master/mainresult/out.psl</constant>

  <step name="makeDataDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeDataDir">
    <paramValue name="dataDir">$$dataDir$$</paramValue>
  </step>

    <subgraph name="blatAgainstGenome" xmlFile="blatAgainstGenome.xml">
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <paramValue name="maxIntronSize">$$maxIntronSize$$</paramValue>
      <paramValue name="targetDir">$$genomicSeqsDir$$</paramValue>
      <paramValue name="queryFile">$$shortSeqsFile$$</paramValue>
      <depends name="makeDataDir"/>
    </subgraph>

    <step name="blatMDust" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::RunMDust">
      <paramValue name="inputSeqsFile">$$shortSeqsFile$$</paramValue>
      <paramValue name="outputSeqsFile">$$mdustOutputFile$$</paramValue>
      <depends name="makeDataDir"/>
    </step>

    <step name="blatToUniqueAndNonUnique" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::SsaBlatToUniqueAndNonUnique">
     <paramValue name="inputShortSeqsFile">$$shortSeqsFile$$</paramValue>
     <paramValue name="inputBlatFile">$$blatOutputFile$$</paramValue>
     <paramValue name="inputMdustFile">$$mdustOutputFile$$</paramValue>
     <paramValue name="outputUniqueFile">$$outputUniqueFile$$</paramValue>
     <paramValue name="outputNonUniqueFile">$$outputNonUniqueFile$$</paramValue>
     <paramValue name="isChipSeq">$$isChipSeq$$</paramValue>
     <paramValue name="readLength">$$readLength$$</paramValue>
     <depends name="blatAgainstGenome"/>
     <depends name="blatMDust"/>
  </step>

</workflowGraph>
