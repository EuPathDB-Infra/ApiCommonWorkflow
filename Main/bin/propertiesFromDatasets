#!/bin/bash
set -e

project=$1

if [ ! $project ]
then 
  echo "
Generate simple property files from dataset files for a provided project.

Usage: propertiesFromDatasets projectName

Where:
   projectName: the project containing the dataset files, eg EuPathDatasets.  This project must contain Datasets/lib/xml where the dataset XML files are.
"
  exit 1
fi

echo "$PROJECT_HOME"
echo "$GUS_HOME"

echo running...
echo validateXmlWithRng  $GUS_HOME/lib/rng/datasetClass.rng $PROJECT_HOME/ApiCommonShared/Model/lib/xml/datasetClass/classes.xml
echo

validateXmlWithRng  $GUS_HOME/lib/rng/datasetClass.rng $PROJECT_HOME/ApiCommonShared/Model/lib/xml/datasetClass/classes.xml

cd $PROJECT_HOME/$project/Datasets/lib/xml/datasets/
for datasetFile in `find -name "*.xml" | grep -v Deprecated`
do
    propFile={$datasetFile//xml/prop}   # replace .xml at end of name with .prop
    #propFile=$datasetFile   # replace .xml at end of name with .prop

  if [ $PROJECT_HOME/$project/Datasets/lib/xml/datasets/$datasetFile -nt "$GUS_HOME/lib/xml/datasetProperties/$propFile" ]
  then
      echo "workflowDataset2PropsFile \$PROJECT_HOME/$project/Datasets/lib/xml/datasets/$datasetFile \$PROJECT_HOME/ApiCommonShared/Model/lib/xml/datasetClass/classes.xml"
      workflowDataset2PropsFile  $PROJECT_HOME/$project/Datasets/lib/xml/datasets/$datasetFile $PROJECT_HOME/ApiCommonShared/Model/lib/xml/datasetClass/classes.xml -skipXmlValidation
  else 
      echo "$propFile already up to date"
  fi    
done

