<workflowGraph name="getAndAnalyzeSNPs.xml">
    <param name="parentDataDir"/>
    <param name="chipResourceName"/>
    <param name="genomicSeqsFile"/>
    <param name="chipExtDbRlsSpec"/>
    <param name="organismResourceXmlFile"/>
    <param name="mapProbesToNaSequences"/>
    <param name="insertSimpleRadAnalysisFromConfig"/>

    <constant name="dataDir">$$parentDataDir$$/$$chipResourceName$$</constant>

    <subgraph name="ChIPResource" xmlFile="loadResource.xml">
      <paramValue name="resourceName">$$chipResourceName$$</paramValue>
      <paramValue name="resourceXmlFileName">$$organismResourceXmlFile$$</paramValue>
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
    </subgraph>

    <step name="mapProbesToNaSequences" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MapSageTagsToNaSequences" includeIf="$$mapProbesToNaSequences$$">
      <paramValue name="genomicSeqsFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="sageTagFile">$$dataDir$$/probes.fsa</paramValue>
      <paramValue name="outputFile">$$dataDir$$/mapProbesToNaSequences.out</paramValue>
      <depends name="ChIPResource"/>
    </step>

    <step name="loadProbesToNaSequencesMap" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::LoadExpressionFeature" stepLoadTypes="plugin" includeIf="$$mapProbesToNaSequences$$">
      <paramValue name="inputFile">$$dataDir$$/mapProbesToNaSequences.out</paramValue>
      <paramValue name="extDbRlsSpec">$$chipExtDbRlsSpec$$</paramValue>
      <paramValue name="featureType">ArrayElementFeature</paramValue>
      <depends name="mapProbesToNaSequences"/>
    </step>

    <step name="insertSimpleRadAnalysisFromConfig" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertSimpleRadAnalysisFromConfig" stepLoadTypes="plugin" includeIf="$$insertSimpleRadAnalysisFromConfig$$">
      <paramValue name="analysisWorkingDir">$$dataDir$$</paramValue>
      <paramValue name="analysisResultView">DataTransformationResult</paramValue>
      <paramValue name="naFeatureView">ArrayElementFeature</paramValue>
      <paramValue name="useSqlLdr">true</paramValue>
      <depends name="loadProbesToNaSequencesMap"/>
    </step>
</workflowGraph>
