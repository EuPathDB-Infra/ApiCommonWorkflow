<workflowGraph name="ChIP-chip">

    <param name="parentDataDir"/>
    <param name="chipNickName"/>
    <param name="genomicSeqsFile"/>
    <param name="probeFileRelativeToManualDeliveryDir"/>
    <param name="chipExtDbRlsSpec"/>
    <param name="inputDir"/>
    <param name="mapProbesToNaSequences"/>

    <constant name="dataDir">$$parentDataDir$$/$$chipNickName$$</constant>
    <constant name="probeFile">$$parentDataDir$$/$$chipNickName$$/probes.fas</constant>

    <step name="makeDataDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeDataDir">
      <paramValue name="dataDir">$$dataDir$$</paramValue>
    </step>

    <step name="copyProbeFile" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::CopyManualDeliveryFile" includeIf="$$mapProbesToNaSequences$$">
      <paramValue name="fromFile">$$probeFileRelativeToManualDeliveryDir$$</paramValue>
      <paramValue name="toFile">$$probeFile$$</paramValue>
      <depends name="makeDataDir"/>
    </step>


    <step name="mapProbesToNaSequences" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MapSageTagsToNaSequences" includeIf="$$mapProbesToNaSequences$$">
      <paramValue name="genomicSeqsFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="sageTagFile">$$probeFile$$</paramValue>
      <paramValue name="outputFile">$$dataDir$$/mapProbesToNaSequences.out</paramValue>
      <depends name="copyProbeFile"/>
      <depends name="makeDataDir"/>
    </step>

    <step name="loadProbesToNaSequencesMap" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::LoadExpressionFeature" stepLoadTypes="plugin" includeIf="$$mapProbesToNaSequences$$">
      <paramValue name="inputFile">$$dataDir$$/mapProbesToNaSequences.out</paramValue>
      <paramValue name="extDbRlsSpec">$$chipExtDbRlsSpec$$</paramValue>
      <paramValue name="featureType">ArrayElementFeature</paramValue>
      <depends name="mapProbesToNaSequences"/>
    </step>

    <step name="insertSimpleRadAnalysisFromConfig" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertSimpleRadAnalysisFromConfig" stepLoadTypes="plugin">
      <paramValue name="analysisWorkingDir">$$inputDir$$</paramValue>
      <paramValue name="analysisResultView">DataTransformationResult</paramValue>
      <paramValue name="naFeatureView">ArrayElementFeature</paramValue>
      <paramValue name="useSqlLdr">true</paramValue>
      <depends name="loadProbesToNaSequencesMap"/>
    </step>

</workflowGraph>
