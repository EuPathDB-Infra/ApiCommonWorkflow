<workflowGraph name="analyzeChIP-Chip">

    <param name="parentDataDir"/>
    <param name="ChIP-ChipResourceName"/>

    <param name="genomicSeqsFile"/>
    <param name="probeFileRelativeToManualDeliveryDir"/>
    <param name="chipExtDbRlsSpec"/>

    <param name="inputDir"/>
    <param name="mapProbesToNaSequences"/>
    <param name="insertSimpleRadAnalysisFromConfig"/>

    <constant name="dataDir">$$parentDataDir$$/analyze_$$ChIP-ChipResourceName$$</constant>

    <step name="makeDataDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeDataDir">
      <paramValue name="dataDir">$$dataDir$$</paramValue>
    </step>

    <step name="transformRawDataToMappedProbeLocations" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::TransformRawDataToMappedProbeLocations">
      <paramValue name="inputFile">$$probeFileRelativeToManualDeliveryDir$$</paramValue>
      <paramValue name="toFile">$$probeFile$$</paramValue>
      <depends name="makeDataDir"/>
    </step>

    <step name="averageRawProbeScoresByGenomeLocation" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::AverageRawProbeScoresByGenomeLocation">
      <paramValue name="genomicSeqsFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="sageTagFile">$$probeFile$$</paramValue>
      <paramValue name="outputFile">$$dataDir$$/mapProbesToNaSequences.out</paramValue>
      <depends name="transformRawDataToMappedProbeLocations"/>
    </step>

    <step name="runChIP-ChipPeakFinder" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::LoadExpressionFeature" stepLoadTypes="plugin" includeIf="$$mapProbesToNaSequences$$">
      <paramValue name="inputFile">$$dataDir$$/mapProbesToNaSequences.out</paramValue>
      <paramValue name="extDbRlsSpec">$$chipExtDbRlsSpec$$</paramValue>
      <paramValue name="featureType">ArrayElementFeature</paramValue>
      <depends name="mapProbesToNaSequences"/>
    </step>

    <step name="insertSimpleRadAnalysisFromConfig" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertSimpleRadAnalysisFromConfig" stepLoadTypes="plugin" includeIf="$$insertSimpleRadAnalysisFromConfig$$">
      <paramValue name="analysisWorkingDir">$$inputDir$$</paramValue>
      <paramValue name="analysisResultView">DataTransformationResult</paramValue>
      <paramValue name="naFeatureView">ArrayElementFeature</paramValue>
      <paramValue name="useSqlLdr">true</paramValue>
      <depends name="loadProbesToNaSequencesMap"/>
    </step>

</workflowGraph>
