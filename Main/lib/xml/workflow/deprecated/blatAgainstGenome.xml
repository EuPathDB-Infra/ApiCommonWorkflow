<workflowGraph name="BlatAgainstGenome">
  <param name="parentDataDir"/>
  <param name="maxIntronSize"/>
  <param name="targetDir"/>
  <param name="queryFile"/>

  <constant name="dataDir">$$parentDataDir$$</constant>
  <constant name="blatOutputFile">$$dataDir$$/blat.out</constant>

    <step name="makeTaskInputDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeGfClientTaskInputDir">
      <paramValue name="taskInputDir">$$dataDir$$/input</paramValue>
      <paramValue name="maxIntronSize">$$maxIntronSize$$</paramValue>
      <paramValue name="queryFile">$$queryFile$$</paramValue>
      <paramValue name="targetDir">$$targetDir$$</paramValue>
    </step>

    <step name="mirrorToCluster" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MirrorToComputeCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$</paramValue>
      <depends name="makeTaskInputDir"/>
    </step>

    <step name="runClusterTask" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::RunAndMonitorClusterTask" stepLoadTypes="cluster">
      <paramValue name="taskInputDir">$$dataDir$$/input</paramValue>
      <paramValue name="numNodes">1</paramValue>
      <paramValue name="processorsPerNode">1</paramValue>
      <depends name="mirrorToCluster"/>
    </step>

    <step name="mirrorFromCluster" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MirrorFromComputeCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$/master</paramValue>
      <paramValue name="outputDir">$$dataDir$$/master/mainresult</paramValue>
      <paramValue name="outputFiles">out.psl</paramValue>
      <depends name="runClusterTask"/>
    </step>

    <step name="fixGenomeSourceIdsInBlatResultFile" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::FixGenomeSourceIdsInBlatResultFile">
      <paramValue name="inputFile">$$dataDir$$/master/mainresult/out.psl</paramValue>
      <depends name="mirrorFromCluster"/>
     </step>

</workflowGraph>
