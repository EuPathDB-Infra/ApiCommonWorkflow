<workflowGraph name="SsaBlat">
  <param name="parentDataDir"/>
  <param name="genomicIndexFile"/>
  <param name="genomicSeqsFile"/>
  <param name="shortSeqsFile"/>
  <param name="outputUniqueFile"/>
  <param name="outputNonUniqueFile"/>
  <param name="isChipSeq"/>

  <constant name="dataDir">$$parentDataDir$$/ssaBlat</constant>
  <constant name="mdustOutputFile">$$dataDir$$/mdust.out</constant>
  <constant name="blatOutputFile">$$dataDir$$/blat.out</constant>

  <step name="makeDataDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeDataDir">
    <paramValue name="dataDir">$$dataDir$$</paramValue>
  </step>

    <step name="blatAgainstGenome" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::RunBlat">
      <paramValue name="subjectIndexFile">$$genomicIndexFile$$</paramValue>
      <paramValue name="querySeqsFile">$$shortSeqsFile$$</paramValue>
      <paramValue name="outputFile">$$blatOutputFile$$</paramValue>

      <depends name="makeDataDir"/>
    </step>

    <step name="blatMDust" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::RunMDust">
      <paramValue name="inputSeqsFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="outputSeqsFile">$$mdustOutputFile$$</paramValue>
      <depends name="makeDataDir"/>
    </step>

    <step name="blatToUniqueAndNonUnique" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::SsaBlatToUniqueAndNonUnique">
     <paramValue name="inputReadSeqsFile">$$shortSeqsFile$$</paramValue>
     <paramValue name="inputBlatFile">$$blatOutputFile$$</paramValue>
     <paramValue name="inputMdustFile">$$mdustOutputFile$$</paramValue>
     <paramValue name="outputUniqueFile">$$outputUniqueFile$$</paramValue>
     <paramValue name="outputNonUniqueFile">$$outputNonUniqueFile$$</paramValue>
     <paramValue name="isChipSeq">$$isChipSeq$$</paramValue>
     <depends name="blatAgainstGenome"/>
     <depends name="blatMDust"/>
  </step>

</workflowGraph>
