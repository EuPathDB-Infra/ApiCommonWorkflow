<workflowGraph name="loadGenome">
      <param name="parentDataDir"/>
      <param name="project"/>
      <param name="orgAbbrev"/>
      <param name="organismName"/>
      <param name="genomeExtDbRlsSpec"/>
      <param name="organismResourceXmlFile"/>
      <param name="organismSpecificISFReference"/>
      <param name="ncbiTaxonId"/>
      <param name="downloadSiteDataDir"/>
      <param name="extractProteins"/>
      <param name="projectName"/>
      <param name="projectVersion"/>
      <param name="haveOrganelleGenomeSequence"/>
      <param name="organelleInitDownloadDirSubgraph"/>

    <constant name="dataDir">$$parentDataDir$$/$$organismName$$LoadGenome</constant>
    <constant name="genomicSeqsFileForSsa">$$dataDir$$/genomicSeqsForSsa.fsa</constant>
    <constant name="transcriptSeqsFileForSsa">$$dataDir$$/transcriptSeqsForSsa.fsa</constant>
    <constant name="geneModelFileForSsa">$$dataDir$$/geneModelForSsa.txt</constant>
    <constant name="genomicSeqsFile">$$dataDir$$/genomicSeqs.fsa</constant>
    <constant name="genomicSeqsDir">$$dataDir$$/genomicSeqs</constant>
    <constant name="proteinsFile">$$dataDir$$/AnnotatedProteins.fsa</constant>
    <constant name="samHeaderFile">$$dataDir$$/samHeader</constant>
    <constant name="bowtieGenomicIndexDir">$$dataDir$$/genomicIndexes</constant>
    <constant name="bowtieTranscriptIndexDir">$$dataDir$$/transcriptsIndexes</constant>
    <constant name="downloadSiteFastaDataDir">$$downloadSiteDataDir$$/$$organismName$$/fasta</constant>
    <constant name="downloadSiteTxtDataDir">$$downloadSiteDataDir$$/$$organismName$$/txt</constant>
    <constant name="downloadSiteGffDataDir">$$downloadSiteDataDir$$/$$organismName$$/gff</constant>
    <constant name="downloadSiteTranscriptExpressionDataDir">$$downloadSiteDataDir$$/$$organismName$$/transcriptExpression</constant>


    <step name="makeDataDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeDataDir">
      <paramValue name="dataDir">$$dataDir$$</paramValue>
    </step>

    <step name="initDownloadSiteDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InitDownloadSiteDir">
       <paramValue name="organismName">$$organismName$$</paramValue>
       <paramValue name="projectName">$$projectName$$</paramValue>
       <paramValue name="projectVersion">$$projectVersion$$</paramValue>
    </step>

    <step name="makeDownloadSiteFastaDataDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeApiSiteFilesDir">
      <paramValue name="apiSiteFilesDir">$$downloadSiteFastaDataDir$$</paramValue>
      <depends name="initDownloadSiteDir"/>
    </step>

    <step name="makeDownloadSiteTxtDataDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeApiSiteFilesDir">
      <paramValue name="apiSiteFilesDir">$$downloadSiteTxtDataDir$$</paramValue>
      <depends name="initDownloadSiteDir"/>
    </step>

    <step name="makeDownloadSiteGffDataDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeApiSiteFilesDir">
      <paramValue name="apiSiteFilesDir">$$downloadSiteGffDataDir$$</paramValue>
      <depends name="initDownloadSiteDir"/>
    </step>

    <step name="makeDownloadSiteTranscriptExpressionDataDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeApiSiteFilesDir">
      <paramValue name="apiSiteFilesDir">$$downloadSiteTranscriptExpressionDataDir$$</paramValue>
      <depends name="initDownloadSiteDir"/>
    </step>

    <subgraph name="initOrganelleDownloadSiteDir" xmlFile="$$organelleInitDownloadDirSubgraph$$" includeIf="$$haveOrganelleGenomeSequence$$">
       <paramValue name="organismName">$$organismName$$</paramValue>
       <paramValue name="projectName">$$projectName$$</paramValue>
       <paramValue name="projectVersion">$$projectVersion$$</paramValue>
       <paramValue name="downloadSiteDataDir">$$downloadSiteDataDir$$</paramValue>
   </subgraph> 

  <step name="insertOrganismProject"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertOrganismProject">
      <paramValue name="organism">$$organismName$$</paramValue>
      <paramValue name="project">$$projectName$$</paramValue>
    </step>

  <subgraph name="organismSpecificISF" xmlFile="$$project$$/$$orgAbbrev$$/genomeSequenceAndFeatures.xml">
    <paramValue name="organismResourceXmlFile">$$organismResourceXmlFile$$</paramValue>
    <paramValue name="dataDir">$$dataDir$$</paramValue>
    <depends name="makeDataDir"/>
  </subgraph>

  <step name="extractGenomicSeqs"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::ExtractNaSeqs">
      <paramValue name="extDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="table">ExternalNASequence</paramValue>
      <paramValue name="alternateDefline"></paramValue>
      <paramValue name="outputFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="separateFastaFiles">false</paramValue>
      <paramValue name="outputDirForSeparateFiles"></paramValue>
      <depends name="organismSpecificISF"/> 
    </step>

    <step name="extractProteins"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::ExtractAnnotatedProteinsBySpecies" includeIf="$$extractProteins$$">
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="ncbiTaxonId">$$ncbiTaxonId$$</paramValue>
      <paramValue name="outputFile">$$proteinsFile$$</paramValue>
      <depends name="organismSpecificISF"/>
    </step>

    <step name="extractGenomicSeqsIntoSeparateFastaFiles"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::ExtractNaSeqs">
      <paramValue name="extDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="table">ExternalNASequence</paramValue>
      <paramValue name="outputFile"></paramValue>
      <paramValue name="alternateDefline"></paramValue>
      <paramValue name="separateFastaFiles">true</paramValue>
      <paramValue name="outputDirForSeparateFiles">$$genomicSeqsDir$$_ori</paramValue>
      <depends name="organismSpecificISF"/>
    </step>


    <step name="fixFileNamesforGenomicSeqsSeparateFasta" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::FixGenomicSeqsSeparateFastaFileNames">
      <paramValue name="inputDir">$$genomicSeqsDir$$_ori</paramValue>
      <paramValue name="outputDir">$$genomicSeqsDir$$</paramValue>
      <depends name="extractGenomicSeqsIntoSeparateFastaFiles"/>
     </step>

    <step name="makeGenomeTargetListFile" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeGenomeTargetListFile">
      <paramValue name="targetDir">$$genomicSeqsDir$$</paramValue>
      <paramValue name="outputFile">$$dataDir$$/targetList</paramValue>
      <depends name="fixFileNamesforGenomicSeqsSeparateFasta"/>
    </step>

  <step name="runTuningManager"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::RunTuningManager">
      <depends name="organismSpecificISF"/> 
  </step>

  <step name="extractGenomicSeqsForSsa"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::ExtractNaSeqsForSsa">
      <paramValue name="ncbiTaxonId">$$ncbiTaxonId$$</paramValue>
      <paramValue name="outputFile">$$genomicSeqsFileForSsa$$</paramValue>
      <depends name="organismSpecificISF"/> 
      <depends name="runTuningManager"/> 
    </step>

  <step name="extractTranscriptSeqsForSsa"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::ExtractTranscriptSeqsForSsa" includeIf="$$extractProteins$$">
      <paramValue name="ncbiTaxonId">$$ncbiTaxonId$$</paramValue>
      <paramValue name="outputFile">$$transcriptSeqsFileForSsa$$</paramValue>
      <depends name="runTuningManager"/> 
    </step>

  <step name="extractGeneModelForSsa"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::ExtractGeneModelForSsa" includeIf="$$extractProteins$$">
      <paramValue name="ncbiTaxonId">$$ncbiTaxonId$$</paramValue>
      <paramValue name="outputFile">$$geneModelFileForSsa$$</paramValue>
      <depends name="runTuningManager"/> 
    </step>

  <step name="makeSamHeader"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeSamHeader">
      <paramValue name="ncbiTaxonId">$$ncbiTaxonId$$</paramValue>
      <paramValue name="outputFile">$$samHeaderFile$$</paramValue>
      <depends name="runTuningManager"/> 
    </step>

    <step name="mirrorToCluster" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MirrorToComputeCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$</paramValue>
      <depends name="extractGenomicSeqs"/>
      <depends name="extractProteins"/>
      <depends name="extractGenomicSeqsForSsa"/>
      <depends name="extractTranscriptSeqsForSsa"/>
      <depends name="extractGeneModelForSsa"/>
      <depends name="makeGenomeTargetListFile"/>
      <dependsGlobal name="initClusterHomeDir"/>
    </step>

    <step name="runNibOnCluster" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::RunNibOnCluster">
      <paramValue name="inputFile">$$dataDir$$/targetList</paramValue>
      <paramValue name="outputDir">$$genomicSeqsDir$$</paramValue>
      <depends name="mirrorToCluster"/>
    </step>


</workflowGraph>
