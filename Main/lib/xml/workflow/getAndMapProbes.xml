<workflowGraph name="getAndMapProbes">
    <param name="parentDataDir"/>
    <param name="probeResourceName"/>
    <param name="organismResourceXmlFile"/>
    <param name="bowtieGenomicIndexFile"/>
    <param name="bowtieTranscriptsIndexFile"/>
    <param name="ssaGeneModelFile"/>
    <param name="genomicSeqsFile"/>
    <param name="genomicSeqsDir"/>
    <param name="chipProbeExtDbRlsSpec"/>
    <param name="isOneChannel"/>
    <param name="loadGeneProbeMapping"/>

    <constant name="dataDir">$$parentDataDir$$/getAndMap_$$probeResourceName$$</constant>
    <constant name="uniqueFile">$$dataDir$$/uniqueMapping.txt</constant>
    <constant name="nonUniqueFile">$$dataDir$$/nonUniqueMapping.txt</constant>

    <step name="makeDataDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeDataDir">
      <paramValue name="dataDir">$$dataDir$$</paramValue>
    </step>

    <subgraph name="probe_RSRC" xmlFile="loadResource.xml">
      <paramValue name="resourceName">$$probeResourceName$$</paramValue>
      <paramValue name="resourceXmlFileName">$$organismResourceXmlFile$$</paramValue>
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <depends name="makeDataDir"/>
    </subgraph>

    <subgraph name="alignProbesToGenome"  xmlFile="ssa.xml">
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <paramValue name="bowtieGenomicIndexFile">$$bowtieGenomicIndexFile$$</paramValue>
      <paramValue name="bowtieTranscriptIndexFile">$$bowtieTranscriptIndexFile$$</paramValue>
      <paramValue name="geneModelFile">$$ssaGeneModelFile$$</paramValue>
      <paramValue name="useTranscripts">true</paramValue>
      <paramValue name="shortSeqsFile">$$dataDir$$/$$probeResourceName$$/probes.fsa</paramValue>
      <paramValue name="genomicSeqsFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="genomicSeqsDir">$$genomicSeqsDir$$</paramValue>
      <paramValue name="outputUniqueFile">$$outputUniqueFile$$</paramValue>
      <paramValue name="outputNonUniqueFile">$$outputNonUniqueFile$$</paramValue>
      <paramValue name="isChipSeq">false</paramValue>
      <paramValue name="readType">single</paramValue>
      <depends name="probe_RSRC"/>
    </step>

    <step name="loadProbeGenomeMapping" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::DoNothingStep" stepLoadTypes="plugin">
      <paramValue name="inputUniqueFile">$$outputUniqueFile$$</paramValue>
      <paramValue name="inputUniqueFile">$$outputNonUniqueFile$$</paramValue>
      <paramValue name="extDbRlsSpec">$$chipProbeExtDbRlsSpec$$</paramValue>
      <paramValue name="featureType">ArrayElementFeature</paramValue>
      <depends name="mapProbeSeqToGenomes"/>
    </step>

    <step name="makeOneChannelProbesGenesMapping" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::DoNothingStep" stepLoadTypes="plugin" includeIf="isOneChannel">
      <paramValue name="inputUniqueFile">$$outputUniqueFile$$</paramValue>
      <paramValue name="inputUniqueFile">$$outputNonUniqueFile$$</paramValue>
      <paramValue name="extDbRlsSpec">$$chipProbeExtDbRlsSpec$$</paramValue>
      <paramValue name="featureType">ArrayElementFeature</paramValue>
      <depends name="mapProbeSeqToGenomes"/>
    </step>

    <step name="makeTwoChannelProbesGenesMapping" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::DoNothingStep" stepLoadTypes="plugin" excludeIf="isOneChannel">
      <paramValue name="inputUniqueFile">$$outputUniqueFile$$</paramValue>
      <paramValue name="inputUniqueFile">$$outputNonUniqueFile$$</paramValue>
      <paramValue name="extDbRlsSpec">$$chipProbeExtDbRlsSpec$$</paramValue>
      <paramValue name="featureType">ArrayElementFeature</paramValue>
      <depends name="mapProbeSeqToGenomes"/>
    </step>

    <step name="loadProbeGenesMapping" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::DoNothingStep" stepLoadTypes="plugin" includeIf="loadGeneProbeMapping">
      <paramValue name="inputUniqueFile">$$outputUniqueFile$$</paramValue>
      <paramValue name="inputUniqueFile">$$outputNonUniqueFile$$</paramValue>
      <paramValue name="extDbRlsSpec">$$chipProbeExtDbRlsSpec$$</paramValue>
      <paramValue name="featureType">ArrayElementFeature</paramValue>
      <depends name="mapProbeSeqToGenomes"/>
    </step>

</workflowGraph>
