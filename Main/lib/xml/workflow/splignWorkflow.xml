<workflowGraph name="splignWorkflow">

    <param name="queryExtDbRlsSpec"/>
    <param name="subjectExtDbRlsSpec"/>
    <param name="parentDataDir"/>

    <constant name="dataDir">$$parentDataDir$$/splign</constant>
    <constant name="queryFastaFile">$$dataDir$$/query.fsa</constant>
    <constant name="subjectFastaFile">$$dataDir$$/subject.fsa</constant>
    <constant name="splignOutputFile">$$dataDir$$/splign.out</constant>

    <step name="makeDataDir" stepClass="ApiCommonData::Load::WorkflowSteps::MakeDataDir">
      <paramValue name="dataDir">$$dataDir$$</paramValue>
    </step>

    <step name="extractQuery" stepClass="ApiCommonData::Steps::ExtractNaSeqs">
      <paramValue name="extDbRlsSpec">$$queryExtDbRlsSpec$$</paramValue>
      <paramValue name="table">ExternalNaSequence</paramValue>
      <paramValue name="alternateDefline">'lcl|'||source_id'</paramValue>
      <paramValue name="outputFile">$$queryFastaFile$$</paramValue>
      <paramValue name="separateFastaFiles">false</paramValue>
      <paramValue name="outputDirForSeparateFiles"></paramValue>
      <depends name="makeDataDir"/>
    </step>

    <step name="extractSubject" stepClass="ApiCommonData::Steps::ExtractNaSeqs">
      <paramValue name="extDbRlsSpec">$$subjectExtDbRlsSpec$$</paramValue>
      <paramValue name="table">ExternalNaSequence</paramValue>
      <paramValue name="alternateDefline">'lcl|'||source_id'</paramValue>
      <paramValue name="outputFile">$$subjectFastaFile$$</paramValue>
      <paramValue name="separateFastaFiles">false</paramValue>
      <paramValue name="outputDirForSeparateFiles"></paramValue>
      <depends name="makeDataDir"/>
    </step>

    <step name="runSplign" stepClass="ApiCommonData::Steps::RunSplign">
      <paramValue name="queryFile">$$queryFastaFile$$</paramValue>
      <paramValue name="subjectFile">$$subjectFastaFile$$</paramValue>
      <paramValue name="outputFile">$$splignOutputFile$$</paramValue>
      <paramValue name="outputDir">$$parentDataDir$$/splign</paramValue>
      <depends name="extractQuery"/>
      <depends name="extractSubject"/>
    </step>

    <step name="insertSplign" stepClass="ApiCommonData::Steps::InsertSplign">
      <paramValue name="queryExtDbRlsSpec">$$queryExtDbRlsSpec$$</paramValue>
      <paramValue name="subjectExtDbRlsSpec">$$subjectExtDbRlsSpec$$</paramValue>
      <paramValue name="inputFile">$$splignOutputFile$$</paramValue>
      <paramValue name="queryTable">ExternalNaSequence</paramValue>
      <paramValue name="subjectTable">ExternalNaSequence</paramValue>
      <depends name="runSplign"/>
    </step>

</workflowGraph>
