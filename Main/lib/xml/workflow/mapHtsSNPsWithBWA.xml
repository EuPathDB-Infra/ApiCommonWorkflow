<workflowGraph name="runRUMOnCluster">
  <paramValue name="readsFile"/>
  <paramValue name="pairedReadsFile"/>
  <paramValue name="hasPairedReads"/>
  <paramValue name="genomicSeqsFile"/>
  <paramValue name="bwaIndexDir"/>
  <paramValue name="strain"/>
  <paramValue name="consPercentCutoff"/>
  <paramValue name="snpPercentCutoff"/>
  <paramValue name="editdistance"/>
  <paramValue name="includeIndels"/>
  <paramValue name="clusterDataDir"/>
  <paramValue name="isHaploid"/>


  <constant name="dataDir">$$parentDataDir$$</constant>
  

     <!-- TODO:  NEED to make this -->
     <step name="makeTaskInputDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeBWATaskInputDir">
      <paramValue name="taskInputDir">$$dataDir$$/input</paramValue>
      <paramValue name="readsFile">$$readsFile$$</paramValue>
      <paramValue name="pairedReadsFile">$$pairedReadsFile$$</paramValue>
      <paramValue name="hasPairedReads">$$hasPairedReads$$</paramValue>
      <paramValue name="genomicSeqsFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="bwaIndexDir">$$bwaIndexDir$$</paramValue>
      <paramValue name="strain">$$strain$$</paramValue>
      <paramValue name="consPercentCutoff">$$consPercentCutoff$$</paramValue>
      <paramValue name="snpPercentCutoff">$$snpPercentCutoff$$</paramValue>
      <paramValue name="strandSpecific">$$strandSpecific$$</paramValue>
      <paramValue name="editdistance">$$editdistance$$</paramValue>
      <paramValue name="includeIndels">$$includeIndels$$</paramValue>
     </step>


    <step name="mirrorToCluster" stepClass="ReFlow::StepClasses::MirrorToComputeCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$/input</paramValue>
      <depends name="makeTaskInputDir"/>
    </step>

    <step name="runClusterTask" stepClass="ReFlow::StepClasses::RunAndMonitorDistribJob" stepLoadTypes="cluster">
      <paramValue name="taskInputDir">$$dataDir$$/input</paramValue>
      <paramValue name="numNodes">1</paramValue>
      <paramValue name="maxMemoryGigs">3</paramValue>
      <paramValue name="processorsPerNode">1</paramValue>
      <depends name="mirrorToCluster"/>
    </step>

    <step name="mirrorFromCluster" stepClass="ReFlow::StepClasses::MirrorFromComputeCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$/master</paramValue>
      <paramValue name="outputDir">$$dataDir$$/master/mainresult</paramValue>
      <paramValue name="outputFiles">result.bai,result.bam,result.consensus.fa,result.insertions.gff,result.SNPs.gff</paramValue>
      <depends name="runClusterTask"/>
    </step>



</workflowGraph>



