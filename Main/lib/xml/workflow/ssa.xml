<workflowGraph name="Ssa">
  <param name="parentDataDir"/>
  <param name="bowtieGenomicIndexDir"/>
  <param name="bowtieTranscriptIndexDir"/>
  <param name="geneModelFile"/>
  <param name="genomicSeqsFile"/>
  <param name="genomicSeqsDir"/>
  <param name="useTranscripts"/>
  <param name="shortSeqsFile"/>
  <param name="outputUniqueFile"/>
  <param name="outputNonUniqueFile"/>
  <param name="isChipSeq"/>
  <param name="readType"/>

  <constant name="dataDir">$$parentDataDir$$/ssaBlat</constant>
  <constant name="bowtieUniqueFile">$$dataDir$$/bowtieUnique</constant>
  <constant name="bowtieNonUniqueFile">$$dataDir$$/bowtieNonUnique</constant>
  <constant name="bowtieUnmappedFile">$$dataDir$$/bowtieUnmapped</constant>
  <constant name="blatFile">$$dataDir$$/blat.out</constant>
  <constant name="blatUniqueFile">$$dataDir$$/blatUnique</constant>
  <constant name="blatNonUniqueFile">$$dataDir$$/blatNonUnique</constant>

  <step name="makeDataDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeDataDir">
    <paramValue name="dataDir">$$dataDir$$</paramValue>
  </step>

  <subgraph name="bowtieGenome" xmlFile="ssaBowtie.xml" excludeIf="$$useTranscripts$$">
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <paramValue name="shortSeqsFile">$$shortSeqsFile$$</paramValue>
      <paramValue name="subjectIndexFile">$$bowtieGenomicIndexDir$$</paramValue>
      <paramValue name="geneModelFile">$$geneModelFile$$</paramValue>
      <paramValue name="transcriptOrGenome">genome</paramValue>
      <paramValue name="outputUniqueFile">$$bowtieUniqueFile$$</paramValue>
      <paramValue name="outputNonUniqueFile">$$bowtieNonUniqueFile$$</paramValue>
      <depends name="makeDataDir"/>
  </subgraph>

  <subgraph name="bowtieGenomeAndTranscripts" xmlFile="ssaBowtieGenomeAndTranscripts.xml" includeIf="$$useTranscripts$$">
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <paramValue name="shortSeqsFile">$$shortSeqsFile$$</paramValue>
      <paramValue name="genomeIndexFile">$$bowtieGenomicIndexDir$$</paramValue>
      <paramValue name="geneModelFile">$$geneModelFile$$</paramValue>
      <paramValue name="transcriptIndexFile">$$bowtieTranscriptIndexDir$$</paramValue>
      <paramValue name="outputUniqueFile">$$bowtieUniqueFile$$</paramValue>
      <paramValue name="outputNonUniqueFile">$$bowtieNonUniqueFile$$</paramValue>
      <paramValue name="readType">$$readType$$</paramValue>
      <depends name="makeDataDir"/>
  </subgraph>

    <step name="findUnmappedSeqs" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::SsaFindBowtieUnmappedSeqs">
      <paramValue name="inputShortSeqsFile">$$shortSeqsFile$$</paramValue>
      <paramValue name="inputBowtieUniqueFile">$$bowtieUniqueFile$$</paramValue>
      <paramValue name="inputBowtieNonUniqueFile">$$bowtieNonUniqueFile$$</paramValue>
      <paramValue name="outputBowtieUnmappedSeqsFile">$$bowtieUnmappedFile$$</paramValue>
      <paramValue name="readType">$$readType$$</paramValue>
      <depends name="makeDataDir"/>
    </step>

  <subgraph name="blatGenome" xmlFile="ssaBlat.xml">
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <paramValue name="shortSeqsFile">$$bowtieUnmappedFile$$</paramValue>
      <paramValue name="genomicSeqsDir">$$genomicSeqsDir$$</paramValue>
      <paramValue name="genomicSeqsFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="outputUniqueFile">$$blatUniqueFile$$</paramValue>
      <paramValue name="outputNonUniqueFile">$$blatNonUniqueFile$$</paramValue>
      <paramValue name="isChipSeq">$$isChipSeq$$</paramValue>
      <depends name="findUnmappedSeqs"/>
  </subgraph>


    <step name="mergeBowtieAndBlat" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::SsaMergBowtieAndBlat">
      <paramValue name="inputBlatUniqueFile">$$blatUniqueFile$$</paramValue>
      <paramValue name="inputBlatNonUniqueFile">$$blatNonUniqueFile$$</paramValue>
      <paramValue name="inputBowtieUniqueFile">$$bowtieUniqueFile$$</paramValue>
      <paramValue name="inputBowtieNonUniqueFile">$$bowtieNonUniqueFile$$</paramValue>
      <paramValue name="outputUniqueFile">$$outputUniqueFile$$</paramValue>
      <paramValue name="outputNonUniqueFile">$$outputNonUniqueFile$$</paramValue>
      <paramValue name="readType">$$readType$$</paramValue>
      <depends name="blatGenome"/>
    </step>



</workflowGraph>
