<workflowGraph name="">
    <param name="dataDir"/>
    <param name="organismAbbrev"/>

    <step name="makeDataDir" stepClass="ReFlow::StepClasses::MakeDataDir">
      <paramValue name="dataDir">$$dataDir$$</paramValue>
    </step>

    <step name="makeAssemblySeqs" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeAssemblySeqs">
      <paramValue name="organismAbbrev">$$organismAbbrev$$</paramValue>
      <paramValue name="useTaxonHierarchy">true</paramValue>
    </step>

    <step name="document-crossmatch"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertAnalysisMethodInvocation">
      <paramValue name="method">crossmatch_MTHD</paramValue>
      <paramValue name="version">0.990319</paramValue>
      <paramValue name="parameters"></paramValue>
      <depends name="makeAssemblySeqs"/>
    </step>

   <step name="extractAssemblySeqs"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::ExtractAssemblySeqs">
      <paramValue name="organismAbbrev">$$organismAbbrev$$</paramValue>
      <paramValue name="useTaxonHierarchy">true</paramValue>
      <paramValue name="outputFile">$$dataDir$$/assemblySeqs.fsa</paramValue>
      <depends name="makeAssemblySeqs"/>
      <depends name="makeDataDir"/>
    </step>

    <step name="makeRepeatMaskerNextflowConfig" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeRepeatMaskerNextflowConfig" >
      <paramValue name="inputFilePath">$$dataDir$$/assemblySeqs.fsa</paramValue>
      <paramValue name="outputDir">$$dataDir$$/results</paramValue>
      <paramValue name="analysisDir">$$dataDir$$</paramValue>
      <paramValue name="configFileName">nextflow.config</paramValue>
      <paramValue name="fastaSubsetSize">1</paramValue>
      <paramValue name="trimDangling">true</paramValue>
      <paramValue name="dangleMax">30</paramValue>
      <paramValue name="rmParams"></paramValue>
      <paramValue name="outputFileName">blocked.seq</paramValue>
      <paramValue name="errorFileName">blocked.err</paramValue>
      <paramValue name="initialMemory">4000</paramValue>
      <paramValue name="increasedMemory">12000</paramValue>
      <paramValue name="maxForks">40</paramValue>
      <paramValue name="maxRetries">2</paramValue>
      <depends name="extractAssemblySeqs"/>
    </step>

    <step name="mirrorToCluster" stepClass="ReFlow::StepClasses::MirrorToComputeCluster" stepLoadTypes="toCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$</paramValue>
      <depends name="makeRepeatMaskerNextflowConfig"/>
    </step>

    <step name="runRepeatMaskerClusterTask" stepClass="ReFlow::StepClasses::RunAndMonitorNextflow">
      <paramValue name="workingDir">$$dataDir$$</paramValue>
      <paramValue name="resultsDir">$$dataDir$$/results</paramValue>
      <paramValue name="nextflowConfigFile">$$dataDir$$/nextflow.config</paramValue>
      <paramValue name="nextflowWorkflow">VEuPathDB/repeat-masker-nextflow</paramValue>
      <paramValue name="isGitRepo">true</paramValue>
      <depends name="mirrorToCluster"/>
    </step>

    <step name="mirrorFromCluster" stepClass="ReFlow::StepClasses::MirrorFromComputeCluster" stepLoadTypes="fromCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$/results</paramValue>
      <paramValue name="outputDir">$$dataDir$$/master/mainresult</paramValue>
      <paramValue name="outputFiles">blocked.err,blocked.seq</paramValue>
      <paramValue name="deleteAfterCopy">false</paramValue>
      <depends name="runRepeatMaskerClusterTask"/>
    </step>

    <step name="document-maskAssemblySeqs"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertAnalysisMethodInvocation">
      <paramValue name="method">repeatmask_assemblyseqs_MTHD</paramValue>
      <paramValue name="version">1.214</paramValue>
      <paramValue name="parameters"></paramValue>
      <depends name="mirrorFromCluster"/>
    </step>


</workflowGraph>
