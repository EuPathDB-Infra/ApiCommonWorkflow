<workflowGraph name="makeAndBlockAssemblySeqs">

    <param name="parentDataDir"/>
    <param name="parentNcbiTaxonId"/>
    <param name="ncbiTaxonId"/>
    <param name="usePredictedTranscripts"/>
    <param name="predictedTranscriptsExtDbRlsSpec"/>
    <param name="dataDir"/>
    <param name="repeatMaskSpecies"/>
    <param name="makeAssemblySeqs"/>

    <step name="makeDataDir" stepClass="ApiCommonData::Load::WorkflowSteps::MakeDataDir">
      <paramValue name="dataDir">$$dataDir$$</paramValue>
    </step>

    <step name="makeAssemblySeqs" stepClass="ApiCommonData::Load::WorkflowSteps::MakeAssemblySeqs" includeIf="$$makeAssemblySeqs$$">
      <paramValue name="parentNcbiTaxonId">$$parentNcbiTaxonId$$</paramValue>
      <paramValue name="useTaxonHierarchy">true</paramValue>
      <paramValue name="predictedTranscriptsExtDbRlsSpec"></paramValue>
    </step>

    <step name="makeAssemblySeqsFromPredictedTranscripts" stepClass="ApiCommonData::Load::WorkflowSteps::MakeAssemblySeqs" includeIf="$$usePredictedTranscripts$$">
      <paramValue name="parentNcbiTaxonId">$$parentNcbiTaxonId$$</paramValue>
      <paramValue name="useTaxonHierarchy">true</paramValue>
      <paramValue name="predictedTranscriptsExtDbRlsSpec">$$predictedTranscriptsExtDbRlsSpec$$</paramValue>
    </step>

   <step name="extractAssemblySeqs"
          stepClass="ApiCommonData::Load::WorkflowSteps::ExtractAssemblySeqs">
      <paramValue name="parentNcbiTaxonId">$$parentNcbiTaxonId$$</paramValue>
      <paramValue name="useTaxonHierarchy">true</paramValue>
      <paramValue name="outputFile">$$dataDir$$/assemblySeqs.fsa</paramValue>
      <depends name="makeAssemblySeqs"/>
      <depends name="makeDataDir"/>
    </step>

    <step name="makeClusterTaskInputDir" stepClass="ApiCommonData::Load::WorkflowSteps::MakeRepeatMaskTaskInputDir">
      <paramValue name="taskInputDir">$$dataDir$$/input</paramValue>
      <paramValue name="seqsFile">$$dataDir$$/assemblySeqs.fsa</paramValue>
      <paramValue name="dangleMax">30</paramValue>
      <paramValue name="options">$$repeatMaskSpecies$$</paramValue>
      <depends name="extractAssemblySeqs"/>
    </step>

    <step name="mirrorToCluster" stepClass="ApiCommonData::Load::WorkflowSteps::MirrorToComputeCluster" stepLoadTypes="cluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$</paramValue>
      <depends name="makeClusterTaskInputDir"/>
    </step>

    <step name="runClusterTask" stepClass="ApiCommonData::Load::WorkflowSteps::RunAndMonitorClusterTask" stepLoadTypes="cluster">
      <paramValue name="taskInputDir">$$dataDir$$/input</paramValue>
      <paramValue name="numNodes">20</paramValue>
      <paramValue name="processorsPerNode">2</paramValue>
      <depends name="mirrorToCluster"/>
    </step>

    <step name="mirrorFromCluster" stepClass="ApiCommonData::Load::WorkflowSteps::MirrorFromComputeCluster" stepLoadTypes="cluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$/master</paramValue>
      <paramValue name="outputDir">$$dataDir$$/master/mainresult</paramValue>
      <paramValue name="outputFiles">blocked.err,blocked.seq</paramValue>
      <depends name="runClusterTask"/>
    </step>


</workflowGraph>
