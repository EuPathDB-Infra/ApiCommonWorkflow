<workflowGraph name="">
    <param name="organismAbbrev"/> 
    <param name="projectName"/> 
    <param name="name"/> 
    <param name="experimentDatasetName"/>
    <param name="experimentName"/>
    <param name="parentDataDir"/>
    <param name="organismDatasetLoaderXmlFile"/>
    <param name="gtfFile"/> 
    <param name="topLevelFastaFile"/>
    <param name="sequencePlatform"/>
    <param name="relativeWebServicesDir"/> 


    

    <constant name="dataDir">$$parentDataDir$$/$$experimentName$$</constant>
    <constant name="analysisConfig">$$parentDataDir$$/$$experimentDatasetName$$/final/analysisConfig.xml</constant>


    <subgraph name="loadDataset" xmlFile="loadDataset.xml">
      	<paramValue name="datasetName">$$experimentDatasetName$$</paramValue>
      	<paramValue name="datasetLoaderXmlFileName">$$organismDatasetLoaderXmlFile$$</paramValue>
     	<paramValue name="parentDataDir">$$parentDataDir$$</paramValue>
    </subgraph>


   <step name="makeSamplesOutputDir" stepClass="ReFlow::StepClasses::MakeDataDir">
      <paramValue name="dataDir">$$dataDir$$</paramValue>
      <depends name="loadDataset"/>
    </step>


    <step name="makeLongReadNextflowConfig" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeLongReadRnaSeqNextflowConfig">
	<paramValue name="analysisDir">$$parentDataDir$$</paramValue> 
      	<paramValue name="FastqFiles">$$parentDataDir$$/$$experimentDatasetName$$/final</paramValue> 
      	<paramValue name="clusterResultDir">$$parentDataDir$$/$$experimentName$$</paramValue>
    	<paramValue name="parentDataDir">$$parentDataDir$$</paramValue>
	<paramValue name="annotation">$$parentDataDir$$/$$gtfFile$$</paramValue>
	<paramValue name="configFileName">$$parentDataDir$$/$$experimentName$$/nextflow.config</paramValue>	
	<paramValue name="reference">$$topLevelFastaFile$$</paramValue>
	<paramValue name="platform">$$sequencePlatform$$</paramValue>
	<paramValue name="databaseBuild">$$experimentDatasetName$$</paramValue>
	<paramValue name="databaseName">$$experimentDatasetName$$</paramValue>
	<paramValue name="talonDataBase">$$experimentDatasetName$$.db</paramValue>
      	<paramValue name="databaseDir">$$parentDataDir$$/$$experimentName$$/database</paramValue>
	<depends name="makeSamplesOutputDir"/>
	
    </step>



    <step name="mirrorToCluster" stepClass="ReFlow::StepClasses::MirrorToComputeCluster" stepLoadTypes="toCluster">
	<paramValue name="fileOrDirToMirror">$$parentDataDir$$</paramValue>
      	<depends name="makeLongReadNextflowConfig"/>
    </step>

    <step name="runLongReadRnaSeqExperiment" stepClass="ReFlow::StepClasses::RunAndMonitorNextflow">
     	<paramValue name="workingDir">$$dataDir$$</paramValue>
      	<paramValue name="resultsDir">$$dataDir$$/results</paramValue>
      	<paramValue name="nextflowConfigFile">$$dataDir$$/nextflow.config</paramValue>
      	<paramValue name="nextflowWorkflow">VEuPathDB/longReadRnaSeq</paramValue>
      	<paramValue name="isGitRepo">true</paramValue>
      	<paramValue name="revision">main</paramValue>
      	<depends name="mirrorToCluster"/>
    </step>

    <step name="copyGffFilesToWebSvc" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::CopyLongReadRnaGffToWebSvc">
        <paramValue name="copyFromDir">$$dataDir$$/Gtf</paramValue>
        <paramValue name="organismAbbrev">$$organismAbbrev$$</paramValue>
        <paramValue name="relativeDir">$$relativeWebServicesDir$$</paramValue>
        <paramValue name="experimentDatasetName">$$experimentDatasetName$$</paramValue>
        <depends name="runLongReadRnaSeqExperiment"/>
    </step>
    
    <step name="copyBamFilesToWebSvc" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::CopyLongReadRnaBamToWebSvc">
        <paramValue name="copyFromDir">$$dataDir$$/bam</paramValue>
        <paramValue name="organismAbbrev">$$organismAbbrev$$</paramValue>
        <paramValue name="relativeDir">$$relativeWebServicesDir$$</paramValue>
        <paramValue name="experimentDatasetName">$$experimentDatasetName$$</paramValue>
        <depends name="runLongReadRnaSeqExperiment"/>
    </step>


</workflowGraph>
