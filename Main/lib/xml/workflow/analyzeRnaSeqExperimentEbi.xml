<workflowGraph name="">
    <param name="projectName"/>
    <param name="organismAbbrev"/>
    <param name="organismDatasetLoaderXmlFile"/>
    <param name="experimentName"/>
    <param name="parentDataDir"/>
    <param name="genomeExtDbRlsSpec"/>
    <param name="experimentDatasetName"/>
    <param name="experimentDatasetVersion"/>
    <param name="strandSpecific"/>
    <param name="topLevelSeqSizeFile"/>
    <param name="topLevelFastaFile"/>
    <param name="topLevelGeneFootprintFile"/>
    <param name="relativeDownloadSiteDir"/>
    <param name="relativeWebServicesDir"/>
    <param name="ebiOrganismName"/>
    <param name="ebiVersion"/>

    <constant name="dataDir">$$parentDataDir$$/$$experimentName$$</constant>
    <constant name="samplesOutputDir">$$dataDir$$/samples</constant>

    <!-- this will make the dataDir as defined by the constant above-->
    <subgraph name="loadDataset" xmlFile="loadDataset.xml">
      <paramValue name="datasetName">$$experimentDatasetName$$</paramValue>
      <paramValue name="datasetLoaderXmlFileName">$$organismDatasetLoaderXmlFile$$</paramValue>
      <paramValue name="parentDataDir">$$parentDataDir$$</paramValue>
    </subgraph>

    <!-- we will download the sample directories here -->
    <step name="makeSamplesOutputDir" stepClass="ReFlow::StepClasses::MakeDataDir">
      <paramValue name="dataDir">$$samplesOutputDir$$</paramValue>
      <depends name="loadDataset"/>
    </step>

    <!--download from EBI ftp-->
    <step name="fetchEbiRNASeq" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::FetchEbiRNASeq">
      <paramValue name="ebiVersion">$$ebiVersion$$</paramValue>
      <paramValue name="ebiOrganismName">$$ebiOrganismName$$</paramValue>
      <paramValue name="experimentName">$$experimentName$$</paramValue>
      <paramValue name="samplesDir">$$samplesOutputDir$$</paramValue>
      <depends name="makeSamplesOutputDir"/>
    </step>

    <!-- for junctions and bed files, prepend the organismAbbrev to a fixed version of the file-->
    <step name="fixSeqIdEbiRNASeq" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::FixSeqIdEbiRNASeq">
      <paramValue name="samplesDir">$$samplesOutputDir$$</paramValue>
      <paramValue name="organismAbbrev">$$organismAbbrev$$</paramValue>
      <depends name="fetchEbiRNASeq"/>
    </step>


    <!--calculate TPM-->
    <!--TODO: requires a step class-->
    <!--TODO: run makeTpmFromHtseqCounts.pl-->

    <!--doTranscriptExpression-->
    <!--TODO: use DoTranscriptExpressionEbi.pm StepClass - already written-->

    <!--run InsertStudyResults-->
    <!-- should be able to copy plugin call from old graph-->

    <!--run normalise coverage-->
    <!-- TODO: use NormalizeBedGraphEbi.pm StepClass - already written-->

    <!--cp bigwig to web services (do this in parent??)-->
    <!--TODO: make sure bigwig files are in the correct locations for this script-->
    <!--should be able to use WorkflowStepClass from old graph-->

    <!--load RNAseq metrics (not sure what we use these for? Haven't looked at this step)-->

</workflowGraph>


