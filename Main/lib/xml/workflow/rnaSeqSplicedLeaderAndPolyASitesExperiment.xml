<workflowGraph name="">
    <param name="projectName"/>
    <param name="organismAbbrev"/>
    <param name="experimentName"/>
    <param name="parentDataDir"/>
    <param name="organismDatasetLoaderXmlFile"/>
<!--    <param name="genomicSeqsFile"/> -->
<!--    <param name="genomeExtDbRlsSpec"/> -->
    <param name="experimentDatasetName"/>
    <param name="experimentDatasetVersion"/>
    <param name="bowtieIndicesDir"/>

    <constant name="dataDir">$$parentDataDir$$/$$experimentName$$</constant>
    <constant name="samplesOutputDir">$$dataDir$$/samplesOutput</constant>

    <step name="makeDataDir" stepClass="ReFlow::StepClasses::MakeDataDir">
      <paramValue name="dataDir">$$dataDir$$</paramValue>
    </step>

    <step name="makeSamplesOutputDir" stepClass="ReFlow::StepClasses::MakeDataDir">
      <paramValue name="dataDir">$$samplesOutputDir$$</paramValue>
      <depends name="makeDataDir"/>
    </step>

<!-- Don't need this -->
  <!-- Create the bowtie indexes -->
<!--  <step name="createBowtieIndices" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::CreateBowtieIndexes">
    <paramValue name="inputFile">$$genomicSeqsFile$$</paramValue>
    <paramValue name="outputIndexDir">$$dataDir$$/bowtie_index</paramValue>
      <paramValue name="colorspace">false</paramValue>
      <paramValue name="bowtieVersion">1</paramValue>
    <depends name="makeDataDir"/>
  </step> -->

    <subgraph name="experiment_RSRC" xmlFile="loadDataset.xml">
      <paramValue name="datasetName">$$experimentDatasetName$$</paramValue>
      <paramValue name="datasetLoaderXmlFileName">$$organismDatasetLoaderXmlFile$$</paramValue>
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <depends name="makeDataDir"/>
    </subgraph>

    <subgraph name="analyzeSamples" xmlFile="generated/$$projectName$$/$$organismAbbrev$$/$$experimentName$$/rnaSeqSplicedLeaderAndPolyASitesSamples.xml">
      <paramValue name="experimentDataDir">$$dataDir$$</paramValue>
      <paramValue name="outputDir">$$samplesOutputDir$$</paramValue>
<!--      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue> -->
<!--      <paramValue name="genomicSeqsFile">$$genomicSeqsFile$$</paramValue> -->
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="experimentDatasetName">$$experimentDatasetName$$</paramValue>
      <paramValue name="experimentDatasetVersion">$$experimentDatasetVersion$$</paramValue>
      <paramValue name="genomicBowtieIndexDir">$$bowtieIndicesDir$$</paramValue> <!--will need to pass this in at the top and change it here -->
      <depends name="makeSamplesOutputDir"/>
      <depends name="experiment_RSRC"/>
<!--  <depends name="createBowtieIndices"/> -->
    </subgraph>

    <step name="document-rna_seq_SplicedLeaderAndPolyASites_experiment"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertAnalysisMethodInvocation">
      <paramValue name="method">rna_seq_SplicedLeaderAndPolyASites_experiment_MTHD</paramValue>
      <paramValue name="version">1.0</paramValue>
      <paramValue name="parameters">TODO: patch in later</paramValue>
    </step>

</workflowGraph>
