<workflowGraph name="genomeAnalysis">

  <param name="parentDataDir"/>
  <param name="organismName"/>
  <param name="organismFullName"/>
  <param name="genomeExtDbRlsSpec"/>
  <param name="soVersion"/>
  <param name="ncbiTaxonId"/>
  <param name="parentNcbiTaxonId"/>
  <param name="usePredictedTranscripts"/>
  <param name="predictedTranscriptsExtDbRlsSpec"/>
  <param name="maxIntronSize"/>
  <param name="distanceBetweenStartsForAlignmentsInSameCluster"/>
  <param name="taxonHierarchyForBlastxFilter"/>
  <param name="nrdbExtDbRlsSpec"/>
  <param name="organismTwoLetterAbbrev"/>
  <param name="repeatMaskSpecies"/>
  <param name="genomeSize"/>
  <param name="runtRNAScan"/>
  <param name="makeAssemblySeqs"/>
  <param name="makeAssemblies"/>
  <param name="mapAssemblySeqsAndAssemblies"/>
  <param name="organismSpecificESTResourcesReference"/>
  <param name="organismSpecificMassSpecResourcesReference"/>
  <param name="organismResourceXmlFile"/>
  <param name="genomicSeqsFile"/>

  <constant name="dataDir">$$parentDataDir$$/genome</constant>
  <constant name="assemblySeqsDataDir">$$dataDir$$/makeAssemblySeqs</constant>
  <constant name="mapAssemblySeqsDataDir">$$dataDir$$/mapAssemblySeqs</constant>
  <constant name="assembliesDataDir">$$dataDir$$/makeAssemblies</constant>
  <constant name="blastxArgs">-cpus=4 -topcomboN=1 W=4 T=18 V=100 B=1000000 -hspmax=1000000 -gi E=1e-3 -wordmask=seg+xnu -hspsepQmax=4000 -span1 Y=$$genomeSize$$</constant>
  <constant name="trfArgs">2 7 7 80 20 50 500</constant>

  <step name="makeDataDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeDataDir">
    <paramValue name="dataDir">$$dataDir$$</paramValue>
  </step>

    <step name="InsertGeneGenomicSequenceWithSql" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::LoadGeneGenomicSequenceByQuery">
      <paramValue name="genomeExtDbRlsSpecList">$$genomeExtDbRlsSpec$$</paramValue>
    </step>

  <subgraph name="dbESTResource" xmlFile="loadResource.xml">
    <paramValue name="resourceName">dbEST</paramValue>
    <paramValue name="resourceXmlFileName">$$organismResourceXmlFile$$</paramValue>
    <paramValue name="dataDir">$$dataDir$$/dbEST</paramValue>
    <depends name="makeDataDir"/>
  </subgraph>

  <subgraph name="organismSpecificESTResource" xmlFile="$$organismSpecificESTResourcesReference$$">
    <paramValue name="organismResourceXmlFile">$$organismResourceXmlFile$$</paramValue>
    <paramValue name="parentDataDir">$$dataDir$$</paramValue>
    <depends name="makeDataDir"/>
  </subgraph>

    <subgraph name="blastxGenomicSeqsNrdb" xmlFile="blast.xml">
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <paramValue name="nickName">blastxNrdb</paramValue>
      <paramValue name="queryFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="queryTable">DoTS::ExternalNASequence</paramValue>
      <paramValue name="queryExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="subjectFile">$$global_NRDBOutputFile_shortDefline$$</paramValue>
      <paramValue name="subjectTable">DoTS::ExternalAASequence</paramValue>
      <paramValue name="subjectExtDbRlsSpec">$$nrdbExtDbRlsSpec$$</paramValue>
      <paramValue name="blastArgs">$$blastxArgs$$</paramValue>
      <paramValue name="idRegex">gi\\|(\\d+)\\|</paramValue>
      <paramValue name="blastType">blastx</paramValue>
      <paramValue name="vendor">wu</paramValue>
      <paramValue name="loadSubjectSubset">true</paramValue>
      <paramValue name="filterByTaxon">true</paramValue>
      <paramValue name="taxonHierarchyForFilter">$$taxonHierarchyForBlastxFilter$$</paramValue>
      <paramValue name="loadOptions"></paramValue>
      <depends name="makeDataDir"/>
      <dependsGlobal name="NRDBResource"/>
    </subgraph>


    <step name="document-blastxGenomicSeqsNrdb"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertAnalysisMethod">
      <paramValue name="name">BLASTX Genomic sequence vs. NRDB</paramValue>
      <paramValue name="tool">WU-BLASTX</paramValue>
      <paramValue name="version">2.0 [06-Apr-2005]</paramValue>
      <paramValue name="category">Genome</paramValue>
      <paramValue name="input">Query: Genomic sequence; Subject: NRDB</paramValue>
      <paramValue name="output">BLASTX alignments</paramValue>
      <paramValue name="parameters">$$blastxArgs$$</paramValue>
      <paramValue name="description">BLASTX genomic sequence against NCBI's non-redundant protein database (NRDB).  WU-BLASTX is used to identify statistically significant DNA-protein sequence similarities found between DNA sequence queries and protein sequence libraries</paramValue>
      <paramValue name="pubmedId">2231712</paramValue>
      <paramValue name="url">http://blast.wustl.edu</paramValue>
      <paramValue name="credits"></paramValue>
      <depends name="blastxGenomicSeqsNrdb"/>
    </step>

    <subgraph name="tRNAScan" xmlFile="trnaScan.xml" includeIf="$$runtRNAScan$$">
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <paramValue name="genomicSeqsFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="tRNAExtDbRlsSpec">$$organismName$$TRNAscan-SE|1.23</paramValue>
      <paramValue name="soVersion">$$soVersion$$</paramValue>
      <depends name="makeDataDir"/>
    </subgraph>

    <step name="document-tRNAScan"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertAnalysisMethod">
      <paramValue name="name">Predict tRNAs in genomic sequence</paramValue>
      <paramValue name="tool">tRNAScan-SE</paramValue>
      <paramValue name="version">1.4</paramValue>
      <paramValue name="category">Genome</paramValue>
      <paramValue name="input">Genomic sequences</paramValue>
      <paramValue name="output">predicted tRNAs with anticodon and score</paramValue>
      <paramValue name="parameters">trainingOption=C</paramValue>
      <paramValue name="description">tRNAscan-SE identifies transfer RNA genes in genomic DNA or RNA sequences.</paramValue>
      <paramValue name="pubmedId">9023104</paramValue>
      <paramValue name="url"></paramValue>
      <paramValue name="credits"></paramValue>
      <depends name="tRNAScan"/>
    </step>

    <step name="makeOrfFile"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeOrfFile">
      <paramValue name="seqFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="minPepLength">50</paramValue>
      <paramValue name="outputFile">$$dataDir$$/Orf50.gff</paramValue>
      <depends name="makeDataDir"/>
    </step>

    <step name="loadOrfFile"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertOrfFile" stepLoadTypes="plugin">
      <paramValue name="inputFile">$$dataDir$$/Orf50.gff</paramValue>
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="substepClass">ExternalNASequence</paramValue>
      <paramValue name="defaultOrg">$$organismFullName$$</paramValue>
      <paramValue name="isfMappingFileRelToGusHome">lib/xml/isf/orf2gus.xml</paramValue>
      <paramValue name="soVersion">$$soVersion$$</paramValue>
      <depends name="makeOrfFile"/>
    </step>

  <subgraph name="organismSpecificMassSpecResource" xmlFile="$$organismSpecificMassSpecResourcesReference$$">
    <paramValue name="organismResourceXmlFile">$$organismResourceXmlFile$$</paramValue>
    <paramValue name="parentDataDir">$$dataDir$$</paramValue>
    <depends name="loadOrfFile"/>
  </subgraph>

    <step name="document-makeOrfFile"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertAnalysisMethod">
      <paramValue name="name">Locate Open Reading Frames (ORFs)</paramValue>
      <paramValue name="tool">orfFinder</paramValue>
      <paramValue name="version"></paramValue>
      <paramValue name="category">Genome</paramValue>
      <paramValue name="input">Genomic sequence</paramValue>
      <paramValue name="output">gff file containing the 6 reading frame, 50 or more amino acid translations of the input nucleic acid</paramValue>
      <paramValue name="parameters">--minPepLength 50</paramValue>
      <paramValue name="description">The translations in all 6 reading frames do not necessarily begin with MET but always end at a stop codon. ORF names are in the form template-frame-start-end, e.g. AAEL01000396-5-5847-4366</paramValue>
      <paramValue name="pubmedId"></paramValue>
      <paramValue name="url"></paramValue>
      <paramValue name="credits"></paramValue>
      <depends name="makeOrfFile"/>
    </step>

    <step name="findTandemRepeats"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::FindTandemRepeats">
      <paramValue name="seqsFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="repeatFinderArgs">$$trfArgs$$</paramValue>
      <paramValue name="outputFile">$$dataDir$$/tandemRepeats.out</paramValue>
      <depends name="makeDataDir"/>
    </step>

    <step name="loadTandemRepeats"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertTandemRepeats" stepLoadTypes="plugin">
      <paramValue name="inputFile">$$dataDir$$/tandemRepeats.out</paramValue>
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <depends name="findTandemRepeats"/>
    </step>

    <step name="document-findTandemRepeats"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertAnalysisMethod">
      <paramValue name="name">Find tandem repeats in genomic sequence</paramValue>
      <paramValue name="tool">Tandem Repeat Finder</paramValue>
      <paramValue name="version">3.21</paramValue>
      <paramValue name="category">Genome</paramValue>
      <paramValue name="input">Genomic sequences</paramValue>
      <paramValue name="output">a repeat table file and an alignment file</paramValue>
      <paramValue name="parameters">$$trfArgs$$</paramValue>
      <paramValue name="description">The Tandem Repeats Finder program locates and displays tandem repeats in DNA sequences</paramValue>
      <paramValue name="pubmedId">9862982</paramValue>
      <paramValue name="url">http://tandem.bu.edu/trf/trf.html</paramValue>
      <paramValue name="credits"></paramValue>
      <depends name="findTandemRepeats"/>
    </step>

   <step name="runLowComplexityFilter"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::RunLowComplexityFilter">

      <paramValue name="seqFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="outputFile">$$genomicSeqsFile$$.dust</paramValue>
      <paramValue name="filterType">dust</paramValue>
      <paramValue name="options"></paramValue>
      <depends name="makeDataDir"/>
    </step>

    <step name="loadLowComplexityFile"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertLowComplexitySequences" stepLoadTypes="plugin">
      <paramValue name="inputFile">$$genomicSeqsFile$$.dust</paramValue>
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="seqType">dna</paramValue>
      <paramValue name="mask">N</paramValue> 
      <paramValue name="options">--LowComplexityName 'dust'</paramValue>
      <depends name="runLowComplexityFilter"/>
    </step>

    <step name="document-runLowComplexityFilter"
          stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InsertAnalysisMethod">
      <paramValue name="name">Filter Low Complexity Genomic Sequences</paramValue>
      <paramValue name="tool">dust</paramValue>
      <paramValue name="version"></paramValue>
      <paramValue name="category">Genome</paramValue>
      <paramValue name="input">Genomic sequences</paramValue>
      <paramValue name="output">Genomic sequences containing regions of low complexity masked with the character 'N'</paramValue>
      <paramValue name="parameters"></paramValue>
      <paramValue name="description"></paramValue>
      <paramValue name="pubmedId"></paramValue>
      <paramValue name="url"></paramValue>
      <paramValue name="credits">Tatusov and Lipman</paramValue>
      <depends name="runLowComplexityFilter"/>
    </step>

    <subgraph name="makeAndBlockAssemblySeqs" xmlFile="makeAndBlockAssemblySeqs.xml" includeIf="$$mapAssemblySeqsAndAssemblies$$">
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <paramValue name="parentNcbiTaxonId">$$parentNcbiTaxonId$$</paramValue>
      <paramValue name="ncbiTaxonId">$$ncbiTaxonId$$</paramValue>
      <paramValue name="usePredictedTranscripts">$$usePredictedTranscripts$$</paramValue>
      <paramValue name="dataDir">$$assemblySeqsDataDir$$</paramValue>
      <paramValue name="repeatMaskSpecies">$$repeatMaskSpecies$$</paramValue>
      <paramValue name="predictedTranscriptsExtDbRlsSpec">$$predictedTranscriptsExtDbRlsSpec$$</paramValue>
      <paramValue name="makeAssemblySeqs">$$makeAssemblySeqs$$</paramValue>
      <depends name="dbESTResource"/>
      <depends name="organismSpecificESTResource"/>
    </subgraph>

    <subgraph name="mapAssemblySeqsToGenome" xmlFile="mapAssemblySeqsToGenome.xml" includeIf="$$mapAssemblySeqsAndAssemblies$$">
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <paramValue name="maxIntronSize">$$maxIntronSize$$</paramValue>
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="parentNcbiTaxonId">$$parentNcbiTaxonId$$</paramValue>
      <paramValue name="ncbiTaxonId">$$ncbiTaxonId$$</paramValue>
      <paramValue name="assemblySeqsDataDir">$$assemblySeqsDataDir$$</paramValue>
      <paramValue name="dataDir">$$mapAssemblySeqsDataDir$$</paramValue>
      <paramValue name="genomicSeqsDir">$$mapAssemblySeqsDataDir$$/genomicSeqs</paramValue>
      <depends name="makeAndBlockAssemblySeqs"/>
    </subgraph>

    <subgraph name="makeAndBlockAssemblies" xmlFile="makeAndBlockAssemblies.xml" includeIf="$$mapAssemblySeqsAndAssemblies$$">
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="parentNcbiTaxonId">$$parentNcbiTaxonId$$</paramValue>
      <paramValue name="ncbiTaxonId">$$ncbiTaxonId$$</paramValue>
      <paramValue name="distanceBetweenStartsForAlignmentsInSameCluster">$$distanceBetweenStartsForAlignmentsInSameCluster$$</paramValue>
      <paramValue name="dataDir">$$assembliesDataDir$$</paramValue>
      <paramValue name="assemblySeqsDataDir">$$assemblySeqsDataDir$$</paramValue>
      <paramValue name="repeatMaskSpecies">$$repeatMaskSpecies$$</paramValue>
      <paramValue name="makeAssemblies">$$makeAssemblies$$</paramValue>
      <depends name="mapAssemblySeqsToGenome"/>
    </subgraph>

    <subgraph name="mapAssembliesToGenome" xmlFile="mapAssembliesToGenome.xml" includeIf="$$mapAssemblySeqsAndAssemblies$$">
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <paramValue name="maxIntronSize">$$maxIntronSize$$</paramValue>
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="ncbiTaxonId">$$ncbiTaxonId$$</paramValue>
      <paramValue name="assembliesDataDir">$$assembliesDataDir$$</paramValue>
      <paramValue name="genomicSeqsDir">$$mapAssemblySeqsDataDir$$/genomicSeqs</paramValue>
      <paramValue name="organismTwoLetterAbbrev">$$organismTwoLetterAbbrev$$</paramValue>
      <paramValue name="nickName">mapAssemblies</paramValue>
      <paramValue name="queryTable">Assembly</paramValue>
      <paramValue name="updateAssemblySourceId">$$makeAssemblies$$</paramValue>
      <paramValue name="queryExtDbRlsSpec"></paramValue>
      <depends name="makeAndBlockAssemblies"/>
    </subgraph>

</workflowGraph>


