<!-- 

$$relativeDownloadSiteDir$$ = downloadSite/$$projectName$$/release-$$projectVersion$$
$$relativeWebservicesDir$$ = webservices/$$projectName$$/release-$$projectVersion$$

-->

<workflowGraph name="">
  <param name="projectName"/>
  <param name="projectVersion"/>

  <constant name="comparativeGenomicsFastaDir">common/comparativeGenomics/Fasta/</constant>
  <constant name="comparativeGenomicsGffDir">common/comparativeGenomics/Gff/</constant>
  <constant name="relativeWebServicesDir">@@webServicesDir@@/$$projectName$$/release-$$projectVersion$$</constant>
  <constant name="relativeDownloadSiteDir">@@downloadSiteDir@@/$$projectName$$/release-$$projectVersion$$/</constant>

  <globalSubgraph name="global" xmlFile="globalGraph.xml">
    <paramValue name="commonResourceXmlFile">$$projectName$$/$$projectName$$Common.xml</paramValue>
    <paramValue name="globalResourceXmlFile">globalResources.xml</paramValue>
  </globalSubgraph>

  <subgraph name="common" xmlFile="common.xml">
    <paramValue name="projectName">$$projectName$$</paramValue>
    <paramValue name="projectVersion">$$projectVersion$$</paramValue>
    <paramValue name="comparativeGenomicsFastaDir">$$comparativeGenomicsFastaDir$$</paramValue>
    <paramValue name="comparativeGenomicsGffDir">$$comparativeGenomicsGffDir$$</paramValue>
    <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
    <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
  </subgraph>

  <datasetTemplate class="organism">
    <prop name="organismAbbrev"/>
    <prop name="projectName"/>
    <prop name="ncbiTaxonId"/>
    <prop name="publicOrganismAbbrev"/>
    <prop name="organismFullName"/>
    <prop name="organismNameForFiles"/>
    <prop name="ncbiTaxonId"/>
    <prop name="speciesNcbiTaxonId"/>
    <prop name="isReferenceGenome"/>
    <prop name="isAnnotatedGenome"/>
    <prop name="isDraftGenome"/>
    <prop name="hasTemporaryNcbiTaxonId"/>
    <prop name="orthomclAbbrev"/>
    <prop name="strainAbbrev"/>
    <prop name="hasPlastidGenomeSequence"/>
    <prop name="hasMitochondrialGenomeSequence"/>
    <prop name="hasDeprecatedGenes"/>
    <prop name="genomeSource"/>
    <prop name="genomeVersion"/>
    <prop name="runtRNAScan"/>
    <prop name="runExportPred"/>
    <prop name="taxonHierarchyForBlastxFilter"/>
    <prop name="skipGenomeAnalysis"/>
    <prop name="includeInComparativeGenomics"/>

    <prop name="mapAssemblySeqsAndAssemblies"/>
    <prop name="distanceBetweenStartsForAlignmentsInSameCluster"/>
    <prop name="usePredictedTranscripts"/>

    <prop name="genomeTopLevelSoTerms"/>

    <prop name="loadEpitope"/>
    <prop name="loadProductName"/>
    <prop name="insertVirtualSeqFromAgpFile"/>

    <prop name="genomeSize"/>
    <prop name="repeatMaskSpecies"/>
    <prop name="maxIntronSize"/>

    <step name="${organismAbbrev}_makeDataDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeDataDir">
      <paramValue name="dataDir">${organismAbbrev}</paramValue>
      <depends name="common"/>      
    </step>

    <subgraph name="${organismAbbrev}_LoadGenome" xmlFile="loadGenome.xml">
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismFullName">${organismFullName}</paramValue>
      <paramValue name="organismNameForFiles">${organismNameForFiles}</paramValue>
      <paramValue name="publicOrganismAbbrev">${publicOrganismAbbrev}</paramValue>
      <paramValue name="ncbiTaxonId">${ncbiTaxonId}</paramValue>
      <paramValue name="speciesNcbiTaxonId">${speciesNcbiTaxonId}</paramValue>
      <paramValue name="isReferenceGenome">${isReferenceGenome}</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <paramValue name="hasTemporaryNcbiTaxonId">${hasTemporaryNcbiTaxonId}</paramValue>
      <paramValue name="orthomclAbbrev">${orthomclAbbrev}</paramValue>
      <paramValue name="strainAbbrev">${strainAbbrev}</paramValue>
      <paramValue name="hasPlastidGenomeSequence">${hasPlastidGenomeSequence}</paramValue>
      <paramValue name="hasMitochondrialGenomeSequence">${hasMitochondrialGenomeSequence}</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome|${genomeVersion}</paramValue>
      <paramValue name="organismResourceXmlFile">$$projectName$$/${organismAbbrev}.xml</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="projectVersion">$$projectVersion$$</paramValue>
      <paramValue name="genomicSeqsFileForSsa">${organismAbbrev}/genomicSeqsForSsa.fsa</paramValue>
      <paramValue name="transcriptSeqsFileForSsa">${organismAbbrev}/transcriptSeqsForSsa.fsa</paramValue>
      <paramValue name="geneModelFileForSsa">${organismAbbrev}/geneModelForSsa.txt</paramValue>
      <paramValue name="genomicSeqsFile">${organismAbbrev}/genomicSeqs.fsa</paramValue>
      <paramValue name="genomicSeqsDir">${organismAbbrev}/genomicSeqs</paramValue>
      <paramValue name="proteinsFile">${organismAbbrev}/AnnotatedProteins.fsa</paramValue>
      <paramValue name="samHeaderFile">${organismAbbrev}/samHeader</paramValue>
      <depends name="${organismAbbrev}_makeDataDir"/>
      <dependsGlobal name="taxonomy_RSRC"/> 
      <dependsGlobal name="SO_RSRC"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_MakeAndMaskTopLevelGenome" xmlFile="makeAndMaskTopLevelGenome.xml">
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismFullName">${organismFullName}</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome|${genomeVersion}</paramValue>
      <paramValue name="insertVirtualSeqFromAgpFile">${insertVirtualSeqFromAgpFile}</paramValue>
      <paramValue name="repeatMaskSpeciesOption">-species ${repeatMaskSpecies}</paramValue>
      <paramValue name="organismResourceXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="comparativeGenomicsFastaDir">$$comparativeGenomicsFastaDir$$</paramValue>
      <paramValue name="comparativeGenomicsGffDir">$$comparativeGenomicsGffDir$$</paramValue>
      <paramValue name="includeInComparativeGenomics">${includeInComparativeGenomics}</paramValue>
      <depends name="${organismAbbrev}_LoadGenome"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_PostLoadGenome" xmlFile="postLoadGenome.xml">
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="projectVersion">$$projectName$$</paramValue>
      <paramValue name="organismFullName">${organismFullName}</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome|${genomeVersion}</paramValue>
      <paramValue name="ncbiTaxonId">${ncbiTaxonId}</paramValue>
      <paramValue name="usePredictedTranscripts">${usePredictedTranscripts}</paramValue>
      <paramValue name="runtRNAScan">${runtRNAScan}</paramValue>
      <paramValue name="runExportPred">${runExportPred}</paramValue>
      <paramValue name="maxIntronSize">${maxIntronSize}</paramValue>
      <paramValue name="taxonHierarchyForBlastxFilter">${taxonHierarchyForBlastxFilter}</paramValue>
      <paramValue name="repeatMaskSpeciesOption">-species ${repeatMaskSpecies}</paramValue>
      <paramValue name="genomeSize">${genomeSize}</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <paramValue name="skipGenomeAnalysis">${skipGenomeAnalysis}</paramValue>
      <paramValue name="loadEpitope">${loadEpitope}</paramValue>
      <paramValue name="isReferenceGenome">${isReferenceGenome}</paramValue>
      <paramValue name="mapAssemblySeqsAndAssemblies">${mapAssemblySeqsAndAssemblies}</paramValue>
      <paramValue name="distanceBetweenStartsForAlignmentsInSameCluster">${distanceBetweenStartsForAlignmentsInSameCluster}</paramValue>
      <paramValue name="organismResourceXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
      <paramValue name="genomicSeqsFile">${organismAbbrev}/genomicSeqs.fsa</paramValue>
      <paramValue name="genomicSeqsDir">${organismAbbrev}/genomicSeqs</paramValue>
      <paramValue name="proteinsFile">${organismAbbrev}/AnnotatedProteins.fsa</paramValue>
      <depends name="${organismAbbrev}_LoadGenome"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_Optional" xmlFile="${projectName}/${organismAbbrev}/optional.xml">
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismResourceXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome|${genomeVersion}</paramValue>
      <paramValue name="maxIntronSize">${maxIntronSize}</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="genomicSeqsFileForSsa">${organismAbbrev}/genomicSeqsForSsa.fsa</paramValue>
      <paramValue name="transcriptSeqsFileForSsa">${organismAbbrev}/transcriptSeqsForSsa.fsa</paramValue>
      <paramValue name="geneModelFileForSsa">${organismAbbrev}/geneModelForSsa.txt</paramValue>
      <paramValue name="genomicSeqsFile">${organismAbbrev}/genomicSeqs.fsa</paramValue>
      <paramValue name="samHeaderFile">${organismAbbrev}/samHeader</paramValue>
      <depends name="${organismAbbrev}_LoadGenome"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_LoadGeneAliases" xmlFile="${projectName}/${organismAbbrev}/geneAliases.xml">
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="projectVersion">$$projectVersion$$</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismResourceXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome|${genomeVersion}</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <depends name="${organismAbbrev}_LoadGenome"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_dbxRefsResource" xmlFile="${projectName}/${organismAbbrev}/dbXRefs.xml">
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismResourceXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="projectVersion">$$projectVersion$$</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <depends name="${organismAbbrev}_LoadGeneAliases"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_MakeAndFormatDownloadFiles" xmlFile="makeAndFormatDownloadFiles.xml">
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="genomeSource">${genomeSource}$</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="projectVersion">$$projectVersion$$</paramValue>
      <paramValue name="dbESTExtDbRlsSpec">${organismAbbrev}_dbEST_RSRC|@@${organismAbbrev}_dbEST_VER@@</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome|${genomeVersion}</paramValue>
      <paramValue name="minOrfLength">50</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <paramValue name="skipGenomeAnalysis">${skipGenomeAnalysis}</paramValue>
      <paramValue name="hasDeprecatedGenes">${hasDeprecatedGenes}</paramValue>
      <paramValue name="genomeTopLevelSoTerms">${genomeTopLevelSoTerms}</paramValue>
      <paramValue name="mapAssemblySeqsAndAssemblies">${mapAssemblySeqsAndAssemblies}</paramValue>
      <depends name="${organismAbbrev}_PostLoadGenome"/>
      <depends name="${organismAbbrev}_MakeAndMaskTopLevelGenome"/>
    </subgraph>

  </datasetTemplate>


  <subgraph name="ComparativeGenomics" xmlFile="comparativeGenomics.xml">
    <paramValue name="parentDataDir">common/comparativeGenomics/</paramValue>
    <paramValue name="mercatorFastaDir">$$comparativeGenomicsFastaDir$$</paramValue>
    <paramValue name="mercatorGffDir">$$comparativeGenomicsGffDir$$</paramValue>
    <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
    <paramValue name="commonResourceXmlFile">$$projectName$$/common.xml</paramValue>
    <dependsPattern name="*_MakeAndMaskTopLevelGenome"/>

  </subgraph>

</workflowGraph>
