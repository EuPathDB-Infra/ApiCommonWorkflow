<workflowGraph name="">
  <param name="organismAbbrev"/>
  <param name="organismResourceXmlFile"/>
  <param name="parentDataDir"/>
  <param name="projectVersion"/>
  <param name="projectName"/>
  <param name="relativeDownloadSiteDir"/>
  <param name="relativeWebServicesDir"/>

  <constant name="dataDir">$$parentDataDir$$/loadESTs</constant>
  <constant name="ESTDescripString">EST sequences (NT)</constant>

  <step name="makeDataDir" stepClass="ReFlow::StepClasses::MakeDataDir">
    <paramValue name="dataDir">$$dataDir$$</paramValue>
  </step>

  <datasetTemplate class="dbEST">
    <prop name="organismAbbrev"/>
    <subgraph name="${organismAbbrev}_dbEST_RSRC" xmlFile="loadResource.xml">
      <paramValue name="resourceName">${organismAbbrev}_dbEST_RSRC</paramValue>
      <paramValue name="resourceXmlFileName">$$organismResourceXmlFile$$</paramValue>
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <depends name="makeDataDir"/>
    </subgraph>
  </datasetTemplate>

  <datasetTemplate class="ESTsFromFasta">
    <prop name="name"/>
    <prop name="organismAbbrev"/>
    <subgraph name="${organismAbbrev}_EST_${name}_sequences_RSRC" xmlFile="loadResource.xml">
      <paramValue name="resourceName">$$organismAbbrev_EST_${name}_sequences_RSRC</paramValue>
      <paramValue name="resourceXmlFileName">$$organismResourceXmlFile$$</paramValue>
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <depends name="makeDataDir"/>
    </subgraph>
  </datasetTemplate>

  <step name="makeESTDownloadFile" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeESTDownloadFile">
    <paramValue name="organismAbbrev">$$organismAbbrev$$</paramValue>
    <paramValue name="projectVersion">$$projectVersion$$</paramValue>
    <paramValue name="projectName">$$projectName$$</paramValue>
    <paramValue name="relativeDir">$$relativeDownloadSiteDir$$</paramValue>
    <paramValue name="fileType">fasta</paramValue>
    <paramValue name="dataName">ESTs</paramValue>
    <paramValue name="descripString">$$ESTDescripString$$</paramValue>
    <dependsPattern name="*_RSRC"/>
  </step>

  <step name="formatESTDownloadFile" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::MakeWebServicesBlastFiles">
    <paramValue name="organismAbbrev">$$organismAbbrev$$</paramValue>
    <paramValue name="projectVersion">$$projectVersion$$</paramValue>
    <paramValue name="projectName">$$projectName$$</paramValue>
    <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
    <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
    <paramValue name="dataName">ESTs</paramValue>
    <paramValue name="args">-n</paramValue>
    <depends name="makeESTDownloadFile"/>
  </step>

</workflowGraph>
