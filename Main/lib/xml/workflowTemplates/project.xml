<!-- 

$$relativeDownloadSiteDir$$ = downloadSite/$$projectName$$/release-$$projectVersionForWebsiteFiles$$
$$relativeWebservicesDir$$ = webservices/$$projectName$$/release-$$projectVersionForWebsiteFiles$$

-->

<workflowGraph name="">
  <param name="projectName"/>
  <param name="projectVersionForWebsiteFiles"/>
  <param name="areBigGenomes"/>

  <constant name="comparativeGenomicsInputDir">comparativeGenomicsInputDir</constant>
  <constant name="relativeWebServicesDir">webServices/$$projectName$$/release-$$projectVersionForWebsiteFiles$$</constant>
  <constant name="relativeDownloadSiteDir">downloadSite/$$projectName$$/release-$$projectVersionForWebsiteFiles$$/</constant>
  <constant name="relativeAuxiliaryDir">auxiliary/$$projectName$$/release-$$projectVersionForWebsiteFiles$$/</constant>

  <globalSubgraph name="global" xmlFile="globalGraph.xml">
    <paramValue name="commonDatasetLoaderXmlFile">$$projectName$$/$$projectName$$Common.xml</paramValue>
    <paramValue name="globalDatasetLoaderXmlFile">global.xml</paramValue>
    <paramValue name="projectName">$$projectName$$</paramValue>
  </globalSubgraph>

  <step name="makeProjectReleaseDownloadDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InitSiteDir">
    <paramValue name="relativeDir">$$relativeDownloadSiteDir$$</paramValue>
      <dependsGlobal name="initUserGroupProject"/>
  </step>

  <step name="makeProjectReleaseWebServicesDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InitSiteDir">
    <paramValue name="relativeDir">$$relativeWebServicesDir$$</paramValue>
      <dependsGlobal name="initUserGroupProject"/>
  </step>

  <step name="makeProjectReleaseAuxiliaryDir" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::InitSiteDir">
    <paramValue name="relativeDir">$$relativeAuxiliaryDir$$</paramValue>
      <dependsGlobal name="initUserGroupProject"/>
  </step>


  <step name="makeComparativeGenomicsDir" stepClass="ReFlow::StepClasses::MakeDataDir">
    <paramValue name="dataDir">$$comparativeGenomicsInputDir$$</paramValue>
  </step>

  <datasetTemplate class="organism">
    <prop name="organismAbbrev"/>
    <prop name="projectName"/>
    <prop name="ncbiTaxonId"/>
    <prop name="publicOrganismAbbrev"/>
    <prop name="organismFullName"/>
    <prop name="organismNameForFiles"/>
    <prop name="ncbiTaxonId"/>
    <prop name="speciesNcbiTaxonId"/>
    <prop name="isReferenceStrain"/>
    <prop name="isFamilyRepresentative"/>
    <prop name="familyRepOrganismAbbrev"/>
    <prop name="familyNcbiTaxonIds"/>
    <prop name="familyNameForFiles"/>
    <prop name="referenceStrainOrganismAbbrev"/>
    <prop name="isAnnotatedGenome"/>
    <prop name="hasTemporaryNcbiTaxonId"/>
    <prop name="orthomclAbbrev"/>
    <prop name="strainAbbrev"/>
    <prop name="genomeSource"/>
    <prop name="genomeVersion"/>
    <prop name="annotationIncludesTRNAs"/>
    <prop name="runExportPred"/>
    <prop name="taxonHierarchyForBlastxFilter"/>
    <prop name="isHugeGenome"/>

    <prop name="maxIntronSize"/>

    <step name="${organismAbbrev}_makeDataDir" stepClass="ReFlow::StepClasses::MakeDataDir" groupName="${organismAbbrev}">
      <paramValue name="dataDir">${organismAbbrev}</paramValue>
    </step>

    <!-- each organism creates this step, but all are ignored except the one
         made by the ref strain. -->
    <step name="${organismAbbrev}_makeStrainsComparisonDir" stepClass="ReFlow::StepClasses::MakeDataDir" includeIf="${isReferenceStrain}" groupName="${organismAbbrev}">
      <paramValue name="dataDir">${organismAbbrev}_strainsComparisonInput</paramValue>
    </step>

    <step name="${organismAbbrev}_mirrorToCluster" stepClass="ReFlow::StepClasses::MirrorToComputeCluster" groupName="${organismAbbrev}">
      <paramValue name="fileOrDirToMirror">${organismAbbrev}</paramValue>
      <depends name="${organismAbbrev}_makeDataDir"/>
      <dependsGlobal name="initClusterHomeDir"/>
    </step>

    <step name="${organismAbbrev}_loadTemporaryNcbiTaxonId" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::LoadTemporaryNcbiTaxonId" includeIf="${hasTemporaryNcbiTaxonId}" groupName="${organismAbbrev}">
      <paramValue name="ncbiTaxonId">${ncbiTaxonId}</paramValue>
      <paramValue name="organismFullName">${organismFullName}</paramValue>
      <paramValue name="speciesNcbiTaxonId">${speciesNcbiTaxonId}</paramValue>
      <dependsGlobal name="taxonomy_RSRC"/> 
    </step>

    <subgraph name="${organismAbbrev}_LoadGenome" xmlFile="loadGenome.xml" groupName="${organismAbbrev}">
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismFullName">${organismFullName}</paramValue>
      <paramValue name="organismNameForFiles">${organismNameForFiles}</paramValue>
      <paramValue name="publicOrganismAbbrev">${publicOrganismAbbrev}</paramValue>
      <paramValue name="ncbiTaxonId">${ncbiTaxonId}</paramValue>
      <paramValue name="speciesNcbiTaxonId">${speciesNcbiTaxonId}</paramValue>
      <paramValue name="isReferenceStrain">${isReferenceStrain}</paramValue>
      <paramValue name="referenceStrainOrganismAbbrev">${referenceStrainOrganismAbbrev}</paramValue>
      <paramValue name="isFamilyRepresentative">${isFamilyRepresentative}</paramValue>
      <paramValue name="familyRepOrganismAbbrev">${familyRepOrganismAbbrev}</paramValue>
      <paramValue name="familyNcbiTaxonIds">${familyNcbiTaxonIds}</paramValue>
      <paramValue name="familyNameForFiles">${familyNameForFiles}</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <paramValue name="hasTemporaryNcbiTaxonId">${hasTemporaryNcbiTaxonId}</paramValue>
      <paramValue name="orthomclAbbrev">${orthomclAbbrev}</paramValue>
      <paramValue name="strainAbbrev">${strainAbbrev}</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome_RSRC|${genomeVersion}</paramValue>
      <paramValue name="organismDatasetLoaderXmlFile">$$projectName$$/${organismAbbrev}.xml</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
      <paramValue name="relativeAuxiliaryDir">$$relativeAuxiliaryDir$$</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="projectVersionForWebsiteFiles">$$projectVersionForWebsiteFiles$$</paramValue>
      <paramValue name="genomicSeqsFile">${organismAbbrev}/loadGenome/genomicSeqs.fa</paramValue>
      <paramValue name="genomicSeqs2BitFile">${organismAbbrev}/loadGenome/genomicSeqs.2bit</paramValue>
      <paramValue name="genomicSeqsDir">${organismAbbrev}/loadGenome/genomicSeqs</paramValue>
      <paramValue name="proteinsFile">${organismAbbrev}/loadGenome/AnnotatedProteins.fsa</paramValue>
      <paramValue name="genomeSource">${genomeSource}</paramValue>
      <depends name="makeProjectReleaseDownloadDir"/>
      <depends name="makeProjectReleaseWebServicesDir"/>
      <depends name="${organismAbbrev}_mirrorToCluster"/>
      <depends name="${organismAbbrev}_loadTemporaryNcbiTaxonId"/>
      <dependsGlobal name="taxonomy_RSRC"/> 
      <dependsGlobal name="SO_RSRC"/>
    </subgraph>

    <!-- we include the ref strain as a prefix so we can use it in a dependsPattern for strain comparison -->
    <subgraph name="${referenceStrainOrganismAbbrev}_${organismAbbrev}_MakeAndMaskTopLevelGenome" xmlFile="makeAndMaskTopLevelGenome.xml" groupName="${organismAbbrev}">
      <paramValue name="dataDir">${organismAbbrev}/makeAndMaskTopLevelGenome</paramValue>
      <paramValue name="topLevelFastaFile">${organismAbbrev}/makeAndMaskTopLevelGenome/topLevelGenomicSeqs.fasta</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="projectName">${projectName}</paramValue>
      <paramValue name="organismDatasetLoaderXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <paramValue name="isHugeGenome">${isHugeGenome}</paramValue>
      <depends name="${organismAbbrev}_LoadGenome"/>
      <depends name="${referenceStrainOrganismAbbrev}_makeStrainsComparisonDir"/>
    </subgraph>

    <!-- we include the ref strain as a prefix so we can use it in a dependsPattern for strain comparison -->
    <subgraph name="${referenceStrainOrganismAbbrev}_${organismAbbrev}_MakeCompGenomicsFiles" xmlFile="makeCompGenomicsFiles.xml" groupName="${organismAbbrev}" excludeIf="${isHugeGenome}">
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="makeAndMaskTopLevelGenomeDataDir">${organismAbbrev}/makeAndMaskTopLevelGenome</paramValue>
      <paramValue name="topLevelFastaFile">${organismAbbrev}/makeAndMaskTopLevelGenome/topLevelGenomicSeqs.fasta</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="comparativeGenomicsDir">$$comparativeGenomicsInputDir$$</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <paramValue name="strainsComparisonInputDir">${referenceStrainOrganismAbbrev}_strainsComparisonInput</paramValue>
      <depends name="makeComparativeGenomicsDir"/>
      <depends name="${referenceStrainOrganismAbbrev}_makeStrainsComparisonDir"/>
      <depends name="${referenceStrainOrganismAbbrev}_${organismAbbrev}_MakeAndMaskTopLevelGenome"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_PostLoadGenome" xmlFile="postLoadGenome.xml" groupName="${organismAbbrev}">
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="projectVersionForWebsiteFiles">$$projectVersionForWebsiteFiles$$</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome_RSRC|${genomeVersion}</paramValue>
      <paramValue name="ncbiTaxonId">${ncbiTaxonId}</paramValue>
      <paramValue name="annotationIncludesTRNAs">${annotationIncludesTRNAs}</paramValue>
      <paramValue name="runExportPred">${runExportPred}</paramValue>
      <paramValue name="maxIntronSize">${maxIntronSize}</paramValue>
      <paramValue name="taxonHierarchyForBlastxFilter">${taxonHierarchyForBlastxFilter}</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <paramValue name="isReferenceStrain">${isReferenceStrain}</paramValue>
      <paramValue name="organismDatasetLoaderXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
      <paramValue name="genomicSeqsFile">${organismAbbrev}/loadGenome/genomicSeqs.fa</paramValue>
      <paramValue name="genomicSeqsDir">${organismAbbrev}/loadGenome</paramValue>
      <paramValue name="proteinsFile">${organismAbbrev}/loadGenome/AnnotatedProteins.fsa</paramValue>
      <paramValue name="isHugeGenome">${isHugeGenome}</paramValue>
      <depends name="${organismAbbrev}_LoadGenome"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_gsnap_topLevel" xmlFile="generated/${projectName}/${organismAbbrev}/gsnap.xml" excludeIfXmlFileDoesNotExist="true" groupName="${organismAbbrev}">
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismDatasetLoaderXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome_RSRC|${genomeVersion}</paramValue>
      <paramValue name="maxIntronSize">${maxIntronSize}</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
      <paramValue name="topLevelFastaFile">${organismAbbrev}/makeAndMaskTopLevelGenome/topLevelGenomicSeqs.fasta</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <depends name="${referenceStrainOrganismAbbrev}_${organismAbbrev}_MakeAndMaskTopLevelGenome"/>
    </subgraph>


    <subgraph name="${organismAbbrev}_bowtieMapping" xmlFile="mapWithBowtie.xml"  excludeIfXmlFileDoesNotExist="true"  groupName="${organismAbbrev}">
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="organismDatasetLoaderXmlFile">$$projectName$$/${organismAbbrev}.xml</paramValue>
      <paramValue name="genomicSeqsDir">${organismAbbrev}/makeAndMaskTopLevelGenome</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome_RSRC|${genomeVersion}</paramValue>
      <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <depends name="${referenceStrainOrganismAbbrev}_${organismAbbrev}_MakeAndMaskTopLevelGenome"/>
    </subgraph>


    <subgraph name="${organismAbbrev}_LoadAliases" xmlFile="generated/${projectName}/${organismAbbrev}/aliases.xml" excludeIfXmlFileDoesNotExist="true" groupName="${organismAbbrev}">
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="projectVersionForWebsiteFiles">$$projectVersionForWebsiteFiles$$</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismDatasetLoaderXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome_RSRC|${genomeVersion}</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <depends name="${organismAbbrev}_LoadGenome"/>
    </subgraph>


    <subgraph name="${organismAbbrev}_specific_noAlias" xmlFile="OrganismSpecificNoAlias.xml"  groupName="${organismAbbrev}">
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismDatasetLoaderXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome_RSRC|${genomeVersion}</paramValue>
      <paramValue name="maxIntronSize">${maxIntronSize}</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
      <paramValue name="relativeAuxiliaryDir">$$relativeAuxiliaryDir$$</paramValue>
      <paramValue name="projectVersionForWebsiteFiles">$$projectVersionForWebsiteFiles$$</paramValue>
      <paramValue name="genomicSeqsFile">${organismAbbrev}/loadGenome/genomicSeqs.fa</paramValue>
      <paramValue name="genomicSeqsDir">${organismAbbrev}/loadGenome</paramValue>
      <paramValue name="proteinsFile">${organismAbbrev}/loadGenome/AnnotatedProteins.fsa</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <depends name="${organismAbbrev}_LoadGenome"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_specific" xmlFile="OrganismSpecific.xml"  groupName="${organismAbbrev}">
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismDatasetLoaderXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome_RSRC|${genomeVersion}</paramValue>
      <paramValue name="maxIntronSize">${maxIntronSize}</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
      <paramValue name="relativeAuxiliaryDir">$$relativeAuxiliaryDir$$</paramValue>
      <paramValue name="projectVersionForWebsiteFiles">$$projectVersionForWebsiteFiles$$</paramValue>
      <paramValue name="genomicSeqsFile">${organismAbbrev}/loadGenome/genomicSeqs.fa</paramValue>
      <paramValue name="genomicSeqsDir">${organismAbbrev}/loadGenome/genomicSeqs</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <depends name="${organismAbbrev}_LoadAliases"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_dbXRefs" xmlFile="generated/${projectName}/${organismAbbrev}/dbXRefs.xml" excludeIfXmlFileDoesNotExist="true" groupName="${organismAbbrev}">
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismDatasetLoaderXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="proteinsFile">${organismAbbrev}/loadGenome/AnnotatedProteins.fsa</paramValue>
      <paramValue name="projectVersionForWebsiteFiles">$$projectVersionForWebsiteFiles$$</paramValue>
      <depends name="${organismAbbrev}_LoadAliases"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_MakeWebsiteFiles" xmlFile="makeOrganismWebsiteFiles.xml" groupName="${organismAbbrev}">
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="genomeSource">${genomeSource}</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="projectVersionForWebsiteFiles">$$projectVersionForWebsiteFiles$$</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome_RSRC|${genomeVersion}</paramValue>
      <paramValue name="minOrfLength">50</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <paramValue name="isHugeGenome">${isHugeGenome}</paramValue>
      <depends name="${organismAbbrev}_PostLoadGenome"/>
      <depends name="${referenceStrainOrganismAbbrev}_${organismAbbrev}_MakeAndMaskTopLevelGenome"/>
    </subgraph>

  </datasetTemplate>

    <step name="addConstraints" stepClass="ApiCommonWorkflow::Main::WorkflowSteps::AddConstraintsToSnpTables">
      <paramValue name="dataDir">Snp_Table_Constraint</paramValue>
      <dependsPattern name="*_bowtieMapping"/>
    </step>

  <subgraph name="comparativeGenomics" xmlFile="generated/$$projectName$$/comparativeGenomics.xml">
    <paramValue name="parentDataDir"></paramValue>
    <paramValue name="areBigGenomes">$$areBigGenomes$$</paramValue>
    <paramValue name="comparativeGenomicsInputDir">$$comparativeGenomicsInputDir$$</paramValue>
    <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
    <dependsPattern name="*_MakeAndMaskTopLevelGenome"/>
    <dependsPattern name="*_MakeCompGenomicsFiles"/>
  </subgraph>


  <!-- only reference strains have an instance of this -->
  <!-- it depends on all make and mask genomes for this organism (they all have the ref strain as a prefix) -->
  <datasetTemplate class="referenceStrain">
    <prop name="organismAbbrev"/>      <!-- same as referenceStrainOrganismAbbrev -->
    <prop name="isAnnotatedGenome"/>  <!-- if ref strain is annotated -->

    <subgraph name="${organismAbbrev}_strainsComparison" xmlFile="strainsComparison.xml" includeIf="${isAnnotatedGenome} &amp;&amp; !$$areBigGenomes$$" groupName="${organismAbbrev}" >
      <paramValue name="parentDataDir"></paramValue>
      <paramValue name="referenceStrainOrganismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="strainsComparisonDir">${organismAbbrev}_strainsComparisonInput</paramValue>
      <dependsPattern name="${organismAbbrev}_*_MakeAndMaskTopLevelGenome"/>
      <dependsPattern name="${organismAbbrev}_*_MakeCompGenomicsFiles"/>
    </subgraph>

  </datasetTemplate>

  <datasetTemplate class="Pathways">
   <prop name="projectName"/>     
   <prop name="version"/>
   <prop name="format"/>
   <prop name="source"/>

   <subgraph name="Pathways_${source}_RSRC" xmlFile="loadDataset.xml">
      <paramValue name="datasetName">Pathways_${source}_RSRC</paramValue>
      <paramValue name="datasetLoaderXmlFileName">${projectName}.xml</paramValue>
      <paramValue name="parentDataDir"></paramValue>
      <dependsGlobal name="enzymeDB_RSRC"/>
      <dependsGlobal name="oboOntologies"/>
      <dependsGlobal name="chEBI_Compounds"/>
   </subgraph>

    <step name="makePathwayDownloadFile_${source}" stepClass="ApiCommonWorkflow::Mail::WorkflowSteps::MakePathwayDownloadFiles">
        <paramValue name="outputDir">$$relativeDownloadSiteDir$$/pathwayFiles/${source}</paramValue>
        <paramValue name="extDbRlsSpec">Pathways_${source}_RSRC|${version}</paramValue>
        <depends name="Pathways_${source}_RSRC"/>
    </step>
    
  </datasetTemplate>

 <datasetTemplate class="metaboliteProfiles">
   <prop name="experimentName"/> 
    <prop name="experimentVersion"/> 

    <subgraph name="metaboliteProfiles_${experimentName}_RSRC" xmlFile="loadDataset.xml">
      <paramValue name="datasetName">metaboliteProfiles_${experimentName}_RSRC</paramValue>
      <paramValue name="datasetLoaderXmlFileName">$$projectName$$.xml</paramValue>
      <paramValue name="parentDataDir"></paramValue>
      <dependsPattern name="*Compounds"/>
    </subgraph>

    <subgraph name="MetaboliteProfiles" xmlFile="metaboliteProfiles.xml">
      <paramValue name="parentDataDir"></paramValue>
      <paramValue name="experimentName">metaboliteProfiles_${experimentName}_RSRC</paramValue>
      <paramValue name="experimentVersion">${experimentVersion}</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <depends name="metaboliteProfiles_${experimentName}_RSRC"/>

<!--TODO add global dependency on compounds-->
    </subgraph>

</datasetTemplate>

<!-- EuPath Ontology and Study MetaData -->
<subgraph name="metadata" xmlFile="metadata.xml" >
    <paramValue name="datasetLoaderXmlFileName">$$projectName$$.xml</paramValue>
    <paramValue name="parentDataDir"></paramValue>
    <paramValue name="projectName">$$projectName$$</paramValue>
    <dependsPattern name="*specific*"/>
    <dependsGlobal name="oboOntologies"/>
</subgraph>


<!--A generic dataset template to copy and format files from EuPathDB manualDelivery to download sites and web services-->
 <datasetTemplate class="copyAndFormatDownloadFilesFromManualDelivery">
   <prop name="projectName"/>
   <prop name="relativeManualDeliveryDir"/>
   <prop name="relativeDownloadSiteDir"/>
   <prop name="relativeWebServiceDir"/>
   <prop name="datasetName"/>
   <prop name="formatDownloadFile"/>
   <prop name="argsOfFormatingDownloadFile"/> 
   <prop name="formattedOutputName"/>
   <prop name="inputFileNameRegex"/>


    <subgraph name="CopyAndFormatDownloadFilesFromManualDelivery" xmlFile="copyAndFormatDownloadFilesFromManualDelivery.xml">
      <paramValue name="relativeManualDeliveryDir">${relativeManualDeliveryDir}</paramValue>
      <paramValue name="relativeDownloadSiteDir">${relativeDownloadSiteDir}</paramValue>
      <paramValue name="relativeWebServiceDir">${relativeWebServiceDir}</paramValue>
      <paramValue name="datasetName">${datasetName}</paramValue>
      <paramValue name="projectName">${projectName}</paramValue>
      <paramValue name="formatDownloadFile">${formatDownloadFile}</paramValue>
      <paramValue name="argsOfFormatingDownloadFile">${argsOfFormatingDownloadFile}</paramValue>
      <paramValue name="formattedOutputName">${formattedOutputName}</paramValue>
      <paramValue name="inputFileNameRegex">${inputFileNameRegex}</paramValue>
      <dependsGlobal name="initUserGroupProject"/>
    </subgraph>

 </datasetTemplate>

  <datasetTemplate class="EcNumberGenus">
   <prop name="projectName"/>   
>  
   <subgraph name="EcNumberGenus_RSRC" xmlFile="loadDataset.xml">
      <paramValue name="datasetName">EcNumberGenus_RSRC</paramValue>
      <paramValue name="datasetLoaderXmlFileName">${projectName}.xml</paramValue>
      <paramValue name="parentDataDir"></paramValue>
    <depends name="manuallyImproveEcNumberGenus"/>
   </subgraph>
  </datasetTemplate>

</workflowGraph>
