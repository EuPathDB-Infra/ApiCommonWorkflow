
<workflowGraph name="">
  <param name="projectName"/>
  <param name="projectVersionForDatabase"/>
  <param name="projectVersionForWebsiteFiles"/>

  <globalSubgraph name="global" xmlFile="globalGraph.xml">
    <paramValue name="commonResourceXmlFile">$$projectName$$/$$projectName$$Common.xml</paramValue>
    <paramValue name="globalResourceXmlFile">global.xml</paramValue>
    <paramValue name="projectName">$$projectName$$</paramValue>
    <paramValue name="projectVersionForDatabase">$$projectVersionForDatabase$$</paramValue>
  </globalSubgraph>

  <datasetTemplate class="organism">
    <prop name="organismAbbrev"/>
    <prop name="projectName"/>
    <prop name="ncbiTaxonId"/>
    <prop name="publicOrganismAbbrev"/>
    <prop name="organismFullName"/>
    <prop name="organismNameForFiles"/>
    <prop name="ncbiTaxonId"/>
    <prop name="speciesNcbiTaxonId"/>
    <prop name="isReferenceStrain"/>
    <prop name="referenceStrainOrganismAbbrev"/>
    <prop name="isAnnotatedGenome"/>
    <prop name="isHaploid"/>
    <prop name="hasTemporaryNcbiTaxonId"/>
    <prop name="orthomclAbbrev"/>
    <prop name="strainAbbrev"/>
    <prop name="hasDeprecatedGenes"/>
    <prop name="genomeSource"/>
    <prop name="genomeVersion"/>
    <prop name="annotationIncludesTRNAs"/>
    <prop name="runExportPred"/>
    <prop name="taxonHierarchyForBlastxFilter"/>
    <prop name="skipGenomeAnalysis"/>

    <prop name="maxIntronSize"/>

    <step name="${organismAbbrev}_makeDataDir" stepClass="ReFlow::StepClasses::MakeDataDir" groupName="${organismAbbrev}">
      <paramValue name="dataDir">${organismAbbrev}</paramValue>
    </step>

    <subgraph name="${organismAbbrev}_LoadGenome" xmlFile="loadGenome.xml" groupName="${organismAbbrev}">
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismFullName">${organismFullName}</paramValue>
      <paramValue name="organismNameForFiles">${organismNameForFiles}</paramValue>
      <paramValue name="publicOrganismAbbrev">${publicOrganismAbbrev}</paramValue>
      <paramValue name="ncbiTaxonId">${ncbiTaxonId}</paramValue>
      <paramValue name="speciesNcbiTaxonId">${speciesNcbiTaxonId}</paramValue>
      <paramValue name="isReferenceStrain">${isReferenceStrain}</paramValue>
      <paramValue name="referenceStrainOrganismAbbrev">${referenceStrainOrganismAbbrev}</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <paramValue name="hasTemporaryNcbiTaxonId">${hasTemporaryNcbiTaxonId}</paramValue>
      <paramValue name="orthomclAbbrev">${orthomclAbbrev}</paramValue>
      <paramValue name="strainAbbrev">${strainAbbrev}</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome_RSRC|${genomeVersion}</paramValue>
      <paramValue name="organismResourceXmlFile">$$projectName$$/${organismAbbrev}.xml</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="projectVersionForWebsiteFiles">$$projectVersionForWebsiteFiles$$</paramValue>
      <paramValue name="genomicSeqsFile">${organismAbbrev}/loadGenome/genomicSeqs.fsa</paramValue>
      <paramValue name="genomicSeqsListFile">${organismAbbrev}/loadGenome/genomicSeqsList.txt</paramValue>
      <paramValue name="genomicSeqsDir">${organismAbbrev}/loadGenome/genomicSeqs</paramValue>
      <paramValue name="proteinsFile">${organismAbbrev}/loadGenome/AnnotatedProteins.fsa</paramValue>
      <paramValue name="genomeSource">${genomeSource}</paramValue>
      <depends name="makeProjectReleaseDownloadDir"/>
      <depends name="makeProjectReleaseWebServicesDir"/>
      <depends name="${organismAbbrev}_mirrorToCluster"/>
      <dependsGlobal name="taxonomy_RSRC"/> 
      <dependsGlobal name="SO_RSRC"/>
    </subgraph>

    <subgraph name="${referenceStrainOrganismAbbrev}_${organismAbbrev}_MakeAndMaskTopLevelGenome" xmlFile="makeAndMaskTopLevelGenome.xml" groupName="${organismAbbrev}">
      <paramValue name="dataDir">${organismAbbrev}/makeAndMaskTopLevelGenome</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="projectName">${projectName}</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome_RSRC|${genomeVersion}</paramValue>
      <paramValue name="organismResourceXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="comparativeGenomicsDir">$$comparativeGenomicsInputDir$$</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <paramValue name="strainsComparisonInputDir">${referenceStrainOrganismAbbrev}_strainsComparisonInput</paramValue>
      <depends name="makeComparativeGenomicsDir"/>
      <depends name="${organismAbbrev}_LoadGenome"/>
      <depends name="${referenceStrainOrganismAbbrev}_makeStrainsComparisonDir"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_PostLoadGenome" xmlFile="postLoadGenome.xml" groupName="${organismAbbrev}">
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="projectVersionForWebsiteFiles">$$projectName$$</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome_RSRC|${genomeVersion}</paramValue>
      <paramValue name="ncbiTaxonId">${ncbiTaxonId}</paramValue>
      <paramValue name="annotationIncludesTRNAs">${annotationIncludesTRNAs}</paramValue>
      <paramValue name="runExportPred">${runExportPred}</paramValue>
      <paramValue name="maxIntronSize">${maxIntronSize}</paramValue>
      <paramValue name="taxonHierarchyForBlastxFilter">${taxonHierarchyForBlastxFilter}</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <paramValue name="skipGenomeAnalysis">${skipGenomeAnalysis}</paramValue>
      <paramValue name="isReferenceStrain">${isReferenceStrain}</paramValue>
      <paramValue name="organismResourceXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
      <paramValue name="genomicSeqsFile">${organismAbbrev}/loadGenome/genomicSeqs.fsa</paramValue>
      <paramValue name="genomicSeqsDir">${organismAbbrev}/loadGenome/genomicSeqs</paramValue>
      <paramValue name="proteinsFile">${organismAbbrev}/loadGenome/AnnotatedProteins.fsa</paramValue>
      <depends name="${organismAbbrev}_LoadGenome"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_LoadAliases" xmlFile="generated/${projectName}/${organismAbbrev}/aliases.xml" excludeIfXmlFileDoesNotExist="true" groupName="${organismAbbrev}">
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="projectVersionForWebsiteFiles">$$projectVersionForWebsiteFiles$$</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismResourceXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome_RSRC|${genomeVersion}</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <depends name="${organismAbbrev}_LoadGenome"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_specific" xmlFile="generated/${projectName}/${organismAbbrev}/organismSpecific.xml" excludeIfXmlFileDoesNotExist="true" groupName="${organismAbbrev}">
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismResourceXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="genomeExtDbRlsSpec">${organismAbbrev}_primary_genome_RSRC|${genomeVersion}</paramValue>
      <paramValue name="maxIntronSize">${maxIntronSize}</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="relativeWebServicesDir">$$relativeWebServicesDir$$</paramValue>
      <paramValue name="projectVersionForWebsiteFiles">$$projectVersionForWebsiteFiles$$</paramValue>
      <paramValue name="genomicSeqsFile">${organismAbbrev}/loadGenome/genomicSeqs.fsa</paramValue>
      <paramValue name="genomicSeqsDir">${organismAbbrev}/loadGenome/genomicSeqs</paramValue>
      <paramValue name="isHaploid">${isHaploid}</paramValue>
      <paramValue name="isAnnotatedGenome">${isAnnotatedGenome}</paramValue>
      <depends name="${organismAbbrev}_LoadAliases"/>
    </subgraph>

    <subgraph name="${organismAbbrev}_dbXRefs" xmlFile="generated/${projectName}/${organismAbbrev}/dbXRefs.xml" excludeIfXmlFileDoesNotExist="true" groupName="${organismAbbrev}">
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="organismResourceXmlFile">${projectName}/${organismAbbrev}.xml</paramValue>
      <paramValue name="parentDataDir">${organismAbbrev}</paramValue>
      <paramValue name="organismAbbrev">${organismAbbrev}</paramValue>
      <paramValue name="projectName">$$projectName$$</paramValue>
      <paramValue name="relativeDownloadSiteDir">$$relativeDownloadSiteDir$$</paramValue>
      <paramValue name="proteinsFile">${organismAbbrev}/loadGenome/AnnotatedProteins.fsa</paramValue>
      <paramValue name="projectVersionForWebsiteFiles">$$projectVersionForWebsiteFiles$$</paramValue>
      <depends name="${organismAbbrev}_LoadAliases"/>
    </subgraph>

 </datasetTemplate>

</workflowGraph>
